<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ë¶€ ì§ì›ìš© ë¯¼ì›ì²˜ë¦¬ ì±—ë´‡</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
        }

        /* ì¢Œì¸¡ ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 320px;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .new-chat-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .chat-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .chat-item:hover {
            border-color: #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .chat-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-title {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .chat-delete {
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            opacity: 0;
        }

        .chat-item:hover .chat-delete {
            opacity: 1;
        }

        .chat-item.active .chat-delete {
            color: rgba(255, 255, 255, 0.8);
        }

        .chat-delete:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .chat-item.active .chat-delete:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* ë©”ì¸ ì»¨í…íŠ¸ ì˜ì—­ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .chat-section.collapsed {
            flex: 0.4;
        }

        .result-panel {
            flex: 0.6;
            background: #f8fafc;
            border-left: 1px solid #e2e8f0;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .result-panel.show {
            display: flex;
        }

        .result-header {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .result-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            gap: 15px;
        }

        .answer-section {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            padding: 20px;
            flex: 1;
        }

        .generate-btn {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            margin: 15px 0;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .generate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .editable {
            border: 2px dashed #e2e8f0;
            padding: 8px;
            border-radius: 6px;
            cursor: text;
            transition: all 0.2s;
        }

        .editable:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .editable.editing {
            border-color: #667eea;
            background: white;
            outline: none;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .answer-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #4b5563;
            margin-bottom: 15px;
            white-space: pre-line;
        }

        .legal-section {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .legal-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 10px;
        }

        .legal-list {
            padding: 0;
            margin: 0;
        }

        .legal-list div {
            font-size: 0.85rem;
            color: #374151;
            margin-bottom: 8px;
            padding-left: 16px;
            position: relative;
            line-height: 1.5;
        }

        .legal-list div:before {
            content: "â€¢";
            color: #0369a1;
            position: absolute;
            left: 0;
            top: 0;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            color: #374151;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .action-btn.edit {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .action-btn.edit:hover {
            background: #2563eb;
            border-color: #2563eb;
        }

        .action-btn.copy {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .action-btn.copy:hover {
            background: #059669;
            border-color: #059669;
        }

        /* ë²•ë ¹ ì„ íƒ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ */
        .legal-selector-panel {
            position: fixed;
            top: 0;
            right: -50%;
            width: 50%;
            height: 100vh;
            background: white;
            z-index: 1000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            border-left: 1px solid #e2e8f0;
        }

        .legal-selector-panel.show {
            right: 0;
        }

        /* ì˜¤ë²„ë ˆì´ */
        .legal-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .legal-selector-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .legal-selector-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .legal-selector-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .legal-selector-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .legal-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .legal-category-item {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .legal-category-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .legal-category-item.selected {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .legal-category-item.selected:hover {
            background: #bfdbfe;
        }

        .legal-category-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .legal-category-desc {
            font-size: 0.85rem;
            color: #6b7280;
            line-height: 1.4;
        }

        .legal-list-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .legal-list-item:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .legal-item-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }

        .legal-item-desc {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .legal-article-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .legal-article-item:hover {
            border-color: #667eea;
            background: #e0e7ff;
        }

        .legal-article-item.selected {
            border-color: #667eea;
            background: #e0e7ff;
        }

        .legal-article-number {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }

        .legal-article-text {
            font-size: 0.85rem;
            color: #4b5563;
            line-height: 1.5;
        }

        .legal-selector-footer {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            background: #f8fafc;
            display: flex;
            gap: 10px;
        }

        .footer-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .footer-btn.primary {
            background: #667eea;
            color: white;
        }

        .footer-btn.primary:hover {
            background: #5a67d8;
        }

        .footer-btn.secondary {
            background: #e2e8f0;
            color: #374151;
        }

        .footer-btn.secondary:hover {
            background: #d1d5db;
        }

        .main-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-avatar {
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-info h1 {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
        }

        .header-info p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 0.85rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .message {
            margin-bottom: 16px;
            display: flex;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #374151;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .message-text {
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            text-align: right;
        }

        .message.bot .message-time {
            text-align: left;
        }

        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
        }

        .input-container {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            font-size: 0.9rem;
            resize: none;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
            max-height: 120px;
        }

        .message-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .send-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            background: white;
            color: #475569;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .typing-indicator span {
            width: 6px;
            height: 6px;
            background: #94a3b8;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #64748b;
            text-align: center;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h2 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #475569;
        }

        .empty-state p {
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .chat-list::-webkit-scrollbar,
        .messages-container::-webkit-scrollbar {
            width: 4px;
        }

        .chat-list::-webkit-scrollbar-track,
        .messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-list::-webkit-scrollbar-thumb,
        .messages-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .chat-list::-webkit-scrollbar-thumb:hover,
        .messages-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
            
            .chat-list {
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
                padding: 10px 15px;
            }
            
            .chat-item {
                min-width: 200px;
                margin-right: 10px;
                margin-bottom: 0;
            }
            
            .main-header {
                padding: 15px;
            }
            
            .header-info h1 {
                font-size: 1.1rem;
            }
            
            .header-avatar {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }

            .content-wrapper {
                flex-direction: column;
            }

            .chat-section.collapsed {
                flex: 1;
            }

            .result-panel {
                flex: 0.5;
                border-left: none;
                border-top: 1px solid #e2e8f0;
            }

            .result-content {
                flex-direction: column;
                gap: 10px;
            }

            .answer-section {
                flex: none;
            }

            /* ëª¨ë°”ì¼ì—ì„œëŠ” ë²•ë ¹ ì„ íƒ íŒ¨ë„ ì „ì²´ í™”ë©´ */
            .legal-selector-panel {
                right: -100%;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">ì±„íŒ… ë‚´ì—­</div>
                <button class="new-chat-btn" onclick="createNewChat()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    ìƒˆ ëŒ€í™”
                </button>
            </div>
            <div class="chat-list" id="chatList">
                <!-- ì±„íŒ… ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…íŠ¸ -->
        <div class="main-content">
            <div class="main-header">
                <div class="header-title">
                    <div class="header-avatar">ğŸ¤–</div>
                    <div class="header-info">
                        <h1>ë‚´ë¶€ ì§ì›ìš© ë¯¼ì›ì²˜ë¦¬ ì±—ë´‡</h1>
                        <p>ë¯¼ì› ìƒë‹´ ì§€ì› ì‹œìŠ¤í…œ</p>
                    </div>
                </div>
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    ì˜¨ë¼ì¸
                </div>
            </div>

            <div class="content-wrapper">
                <div class="chat-section" id="chatSection">
                    <div class="chat-area">
                        <div class="messages-container" id="messagesContainer">
                            <div class="empty-state" id="emptyState">
                                <div class="empty-state-icon">ğŸ’¬</div>
                                <h2>ìƒˆë¡œìš´ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”</h2>
                                <p>ë¯¼ì› ë‚´ìš©ì„ ì…ë ¥í•˜ì‹œë©´ ì²˜ë¦¬ ë°©ë²•ì„ ì•ˆë‚´í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>

                        <div class="input-area">
                            <div class="input-container">
                                <textarea 
                                    id="messageInput" 
                                    class="message-input"
                                    placeholder="ë¯¼ì› ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                    rows="1"
                                ></textarea>
                                <button id="sendBtn" class="send-btn">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="quick-actions">
                                <button class="quick-btn" onclick="setQuickMessage('ë„ë¡œ ë³´ìˆ˜ ìš”ì²­ ë¯¼ì›ì´ ë“¤ì–´ì™”ëŠ”ë° ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼ í•˜ë‚˜ìš”?')">ë„ë¡œ ë³´ìˆ˜</button>
                                <button class="quick-btn" onclick="setQuickMessage('ê°œì¸ì •ë³´ ê´€ë ¨ ë¯¼ì›ì¸ë° ê´€ë ¨ ë²•ë ¹ì´ ìˆë‚˜ìš”?')">ê°œì¸ì •ë³´</button>
                                <button class="quick-btn" onclick="setQuickMessage('ì˜ˆì‚°ì´ ì†Œìš”ë˜ëŠ” ë¯¼ì›ì¸ë° ë³´ê³ í•´ì•¼ í•˜ë‚˜ìš”?')">ì˜ˆì‚° ë¯¼ì›</button>
                                <button class="quick-btn" onclick="setQuickMessage('ìœ ì‚¬í•œ ë¯¼ì› ì‚¬ë¡€ê°€ ìˆë‚˜ìš”?')">ìœ ì‚¬ ì‚¬ë¡€</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë‹µë³€ ë° ê·¼ê±° íŒ¨ë„ -->
                <div class="result-panel" id="resultPanel">
                    <div class="result-header">
                        <h3>ğŸ“‹ ë¯¼ì› ì²˜ë¦¬ ê²°ê³¼</h3>
                    </div>
                    <div class="result-content">
                        <!-- ë‹µë³€ ë° ê·¼ê±° ì„¹ì…˜ -->
                        <div class="answer-section">
                            <div class="section-title">
                                ğŸ’¬ ë‹µë³€ ë° ê·¼ê±°
                            </div>
                            <div class="answer-text editable" id="answerText" contenteditable="false">
                                ë¯¼ì› ë‚´ìš©ì— ëŒ€í•œ ë‹µë³€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                            </div>
                            <div class="action-buttons">
                                <button class="action-btn edit" onclick="editAnswer()">
                                    âœï¸ ìˆ˜ì •
                                </button>
                                <button class="action-btn copy" onclick="copyAnswer()">
                                    ğŸ“‹ ë³µì‚¬
                                </button>
                            </div>
                        </div>

                        <!-- ê´€ë ¨ ë²•ë ¹ ì„¹ì…˜ -->
                        <div class="answer-section">
                            <div class="section-title">
                                ğŸ“š ê´€ë ¨ ë²•ë ¹
                            </div>
                            <div class="legal-section">
                                <div class="legal-title">ê´€ë ¨ ë²•ë ¹ ë° ê·¼ê±°</div>
                                <div class="legal-list editable" id="legalList" contenteditable="false">
                                    <div>ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ1ì¡° (ëª©ì )</div>
                                    <div>ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ8ì¡° (ì²˜ë¦¬ê¸°ê°„)</div>
                                    <div>ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ9ì¡° (ì²˜ë¦¬ë°©ë²•)</div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="action-btn edit" onclick="editLegal()">
                                    âœï¸ ìˆ˜ì •
                                </button>
                                <button class="action-btn copy" onclick="copyLegal()">
                                    ğŸ“‹ ë³µì‚¬
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë²•ë ¹ ì„ íƒ ì˜¤ë²„ë ˆì´ -->
    <div class="legal-selector-overlay" id="legalSelectorOverlay" onclick="closeLegalSelector()"></div>
    
    <!-- ë²•ë ¹ ì„ íƒ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ -->
    <div class="legal-selector-panel" id="legalSelectorPanel">
        <div class="legal-selector-header">
            <div class="legal-selector-title" id="legalSelectorTitle">ì§€ì¹¨ ì„ íƒ</div>
            <button onclick="closeLegalSelector()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">Ã—</button>
        </div>
        <div class="legal-selector-content" id="legalSelectorContent">
            <!-- ë™ì ìœ¼ë¡œ ë‚´ìš©ì´ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
        </div>
        <div class="legal-selector-footer" id="legalSelectorFooter">
            <button class="footer-btn secondary" onclick="closeLegalSelector()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        const supabaseUrl = 'https://fttztujbbhmaqbvmzuzf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0dHp0dWpiYmhtYXFidm16dXpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMDA4OTAsImV4cCI6MjA3MTY3Njg5MH0.cyoRqzkxyUXd8bjKoh7576eMkpNgAP2aL0ChPTNHlGM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // ì „ì—­ ë³€ìˆ˜
        let currentSessionId = null;
        let currentUserId = 'user_' + Math.random().toString(36).substr(2, 9); // ì„ì‹œ ì‚¬ìš©ì ID
        let chatSessions = [];
        let messages = [];
        let currentLegalStep = 'category'; // category, laws, articles
        let selectedCategories = []; // ì—¬ëŸ¬ ì§€ì¹¨ ì„ íƒ ê°€ëŠ¥
        let selectedLaws = {}; // ê° ì§€ì¹¨ë³„ ì„ íƒëœ ë²•ë ¹ë“¤ {categoryId: [lawIds]}
        let selectedArticles = {}; // ê° ë²•ë ¹ë³„ ì„ íƒëœ ì¡°í•­ë“¤ {lawId: [articleIds]}

        // DOM ìš”ì†Œ
        const chatList = document.getElementById('chatList');
        const messagesContainer = document.getElementById('messagesContainer');
        const emptyState = document.getElementById('emptyState');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');

        // ì±„íŒ… ì„œë¹„ìŠ¤ í´ë˜ìŠ¤
        class ChatService {
            // ìƒˆë¡œìš´ ì±„íŒ… ì„¸ì…˜ ìƒì„±
            static async createSession(userId, sessionName = 'ìƒˆë¡œìš´ ëŒ€í™”') {
                const { data, error } = await supabase
                    .from('chat_sessions')
                    .insert({
                        user_id: userId,
                        session_name: sessionName
                    })
                    .select()
                    .single();

                if (error) {
                    console.error('ì„¸ì…˜ ìƒì„± ì˜¤ë¥˜:', error);
                    throw error;
                }
                return data;
            }

            // ì‚¬ìš©ìì˜ ëª¨ë“  ì±„íŒ… ì„¸ì…˜ ì¡°íšŒ
            static async getSessions(userId) {
                const { data, error } = await supabase
                    .from('chat_sessions')
                    .select('*')
                    .eq('user_id', userId)
                    .order('updated_at', { ascending: false });

                if (error) {
                    console.error('ì„¸ì…˜ ì¡°íšŒ ì˜¤ë¥˜:', error);
                    throw error;
                }
                return data || [];
            }

            // íŠ¹ì • ì„¸ì…˜ì˜ ë©”ì‹œì§€ ì¡°íšŒ
            static async getMessages(sessionId) {
                const { data, error } = await supabase
                    .from('chat_messages')
                    .select('*')
                    .eq('session_id', sessionId)
                    .order('created_at', { ascending: true });

                if (error) {
                    console.error('ë©”ì‹œì§€ ì¡°íšŒ ì˜¤ë¥˜:', error);
                    throw error;
                }
                return data || [];
            }

            // ë©”ì‹œì§€ ì €ì¥
            static async saveMessage(sessionId, content, sender) {
                const { data, error } = await supabase
                    .from('chat_messages')
                    .insert({
                        session_id: sessionId,
                        content,
                        sender
                    })
                    .select()
                    .single();

                if (error) {
                    console.error('ë©”ì‹œì§€ ì €ì¥ ì˜¤ë¥˜:', error);
                    throw error;
                }

                // ì„¸ì…˜ ì—…ë°ì´íŠ¸ ì‹œê°„ ê°±ì‹ 
                await supabase
                    .from('chat_sessions')
                    .update({ updated_at: new Date().toISOString() })
                    .eq('id', sessionId);

                return data;
            }

            // ì„¸ì…˜ ì‚­ì œ
            static async deleteSession(sessionId) {
                const { error } = await supabase
                    .from('chat_sessions')
                    .delete()
                    .eq('id', sessionId);

                if (error) {
                    console.error('ì„¸ì…˜ ì‚­ì œ ì˜¤ë¥˜:', error);
                    throw error;
                }
            }

            // ì„¸ì…˜ ì´ë¦„ ì—…ë°ì´íŠ¸
            static async updateSessionName(sessionId, sessionName) {
                const { error } = await supabase
                    .from('chat_sessions')
                    .update({ session_name: sessionName })
                    .eq('id', sessionId);

                if (error) {
                    console.error('ì„¸ì…˜ ì´ë¦„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                    throw error;
                }
            }
        }

        // ëª¨ë“  ì„¸ì…˜ ë¡œë“œ
        async function loadSessions() {
            // TODO: ì‹¤ì œ DB ì—°ë™ ì‹œ í™œì„±í™”
            /*
            try {
                chatSessions = await ChatService.getSessions(currentUserId);
                renderChatList();
            } catch (error) {
                console.error('ì„¸ì…˜ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
            */
            
            // ì„ì‹œ: ë””ìì¸ ì „ìš© - ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
            chatSessions = [];
            renderChatList();
        }

        // ì±„íŒ… ëª©ë¡ ë Œë”ë§
        function renderChatList() {
            chatList.innerHTML = '';
            
            if (chatSessions.length === 0) {
                chatList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #64748b;">
                        <p style="margin-bottom: 15px;">ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <button onclick="createNewChat()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">ìƒˆ ëŒ€í™” ì‹œì‘í•˜ê¸°</button>
                    </div>
                `;
                return;
            }

            chatSessions.forEach(session => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${currentSessionId === session.id ? 'active' : ''}`;
                chatItem.innerHTML = `
                    <div class="chat-info">
                        <div class="chat-title">${session.session_name}</div>
                        <div class="chat-time">${formatDate(session.updated_at)}</div>
                    </div>
                    <button class="chat-delete" onclick="deleteSession('${session.id}', event)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                `;
                
                chatItem.onclick = (e) => {
                    if (!e.target.closest('.chat-delete')) {
                        selectSession(session.id);
                    }
                };
                
                chatList.appendChild(chatItem);
            });
        }

        // ìƒˆ ì±„íŒ… ìƒì„±
        async function createNewChat() {
            // TODO: ì‹¤ì œ DB ì €ì¥ ê¸°ëŠ¥ êµ¬í˜„ ì‹œ í™œì„±í™”
            /*
            try {
                const session = await ChatService.createSession(currentUserId);
                chatSessions.unshift(session);
                renderChatList();
                selectSession(session.id);
            } catch (error) {
                console.error('ìƒˆ ì±„íŒ… ìƒì„± ì‹¤íŒ¨:', error);
                alert('ìƒˆ ì±„íŒ…ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            */
            
            // ì„ì‹œ: ë””ìì¸ ì „ìš© - ì•Œë¦¼ì°½ ì œê±°ë¨
            
            // ì„ì‹œ ì„¸ì…˜ ID ìƒì„± (ë””ìì¸ìš©)
            const tempSessionId = 'temp_' + Date.now();
            currentSessionId = tempSessionId;
            
            // ì±„íŒ… ëª©ë¡ì— ì„ì‹œ ì„¸ì…˜ ì¶”ê°€ (ë””ìì¸ìš©)
            const tempSession = {
                id: tempSessionId,
                session_name: 'ìƒˆë¡œìš´ ëŒ€í™”',
                updated_at: new Date().toISOString()
            };
            chatSessions.unshift(tempSession);
            renderChatList();
            hideEmptyState();
        }

        // ì„¸ì…˜ ì„ íƒ
        async function selectSession(sessionId) {
            currentSessionId = sessionId;
            renderChatList();
            await loadMessages(sessionId);
            hideEmptyState();
        }

        // ë©”ì‹œì§€ ë¡œë“œ
        async function loadMessages(sessionId) {
            try {
                messages = await ChatService.getMessages(sessionId);
                renderMessages();
            } catch (error) {
                console.error('ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ë©”ì‹œì§€ ë Œë”ë§
        function renderMessages() {
            messagesContainer.innerHTML = '';
            
            messages.forEach(message => {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${message.sender}`;
                messageEl.innerHTML = `
                    <div class="message-content">
                        <div class="message-text">${message.content.replace(/\n/g, '<br>')}</div>
                        <div class="message-time">${formatTime(message.created_at)}</div>
                    </div>
                `;
                messagesContainer.appendChild(messageEl);
            });
            
            scrollToBottom();
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;

            // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
            if (!currentSessionId) {
                await createNewChat();
            }

            // TODO: ì‹¤ì œ DB ì €ì¥ ê¸°ëŠ¥ êµ¬í˜„ ì‹œ í™œì„±í™”
            /*
            try {
                // ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥
                await ChatService.saveMessage(currentSessionId, text, 'user');
                
                // ì„¸ì…˜ ì´ë¦„ ì—…ë°ì´íŠ¸ (ì²« ë©”ì‹œì§€ì¸ ê²½ìš°)
                if (messages.length === 0) {
                    const sessionName = text.length > 20 ? text.substring(0, 20) + '...' : text;
                    await ChatService.updateSessionName(currentSessionId, sessionName);
                    await loadSessions();
                }

                messageInput.value = '';
                messageInput.style.height = 'auto';

                // ë©”ì‹œì§€ ë‹¤ì‹œ ë¡œë“œ
                await loadMessages(currentSessionId);

                // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
                showTypingIndicator();

                // ë´‡ ì‘ë‹µ ì²˜ë¦¬ (ì‹¤ì œë¡œëŠ” LLM API í˜¸ì¶œ)
                setTimeout(async () => {
                    const botResponse = await generateBotResponse(text);
                    await ChatService.saveMessage(currentSessionId, botResponse, 'bot');
                    await loadMessages(currentSessionId);
                    hideTypingIndicator();
                }, 1500);

            } catch (error) {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:', error);
                alert('ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            */

            // ì„ì‹œ: ë””ìì¸ ì „ìš© - UIë§Œ êµ¬í˜„ (ì•Œë¦¼ì°½ ì œê±°)
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ í™”ë©´ì— í‘œì‹œ (ì„ì‹œ)
            addMessageToUI(text, 'user');
            
            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
            showTypingIndicator();

            // ë´‡ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜ (ì„ì‹œ)
            setTimeout(() => {
                const botResponse = generateMockBotResponse(text);
                addMessageToUI(botResponse, 'bot');
                hideTypingIndicator();
                
                // ë‹µë³€ ìƒì„± ë²„íŠ¼ ì¶”ê°€
                addGenerateButton(text, botResponse);
            }, 1500);
        }

        // ë´‡ ì‘ë‹µ ìƒì„± (ëª¨ì˜)
        async function generateBotResponse(userMessage) {
            const responses = {
                'ë„ë¡œ': 'ë„ë¡œ ë³´ìˆ˜ ìš”ì²­ ë¯¼ì›ì— ëŒ€í•œ ì²˜ë¦¬ ì ˆì°¨ë¥¼ ì•ˆë‚´í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n1. ë¯¼ì› ë‚´ìš© í™•ì¸ ë° í˜„ì¥ ì¡°ì‚¬\n2. ë„ë¡œê´€ë¦¬ê³¼ì™€ í˜‘ì˜\n3. ë³´ìˆ˜ ì¼ì • ìˆ˜ë¦½ (ì¼ë°˜ì ìœ¼ë¡œ 2ì£¼ ì´ë‚´)\n4. ë¯¼ì›ì¸ì—ê²Œ ì²˜ë¦¬ ì¼ì • ì•ˆë‚´\n5. ë³´ìˆ˜ ì™„ë£Œ í›„ ê²°ê³¼ í†µë³´\n\nê´€ë ¨ ë²•ë ¹: ë„ë¡œë²• ì œ2ì¡°, ì œ19ì¡°, ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ8ì¡°',
                'ê°œì¸ì •ë³´': 'ê°œì¸ì •ë³´ ê´€ë ¨ ë¯¼ì› ì²˜ë¦¬ ì ˆì°¨ë¥¼ ì•ˆë‚´í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n1. ë¯¼ì› ë‚´ìš© ê²€í†  ë° ê°œì¸ì •ë³´ë³´í˜¸ë²• ì ìš© ê²€í† \n2. ê°œì¸ì •ë³´ë³´í˜¸ìœ„ì›íšŒ í˜‘ì˜ (í•„ìš”ì‹œ)\n3. ê´€ë ¨ ë¶€ì„œ ì¡°ì‚¬ ë° ê°œì„  ì¡°ì¹˜\n4. ë¯¼ì›ì¸ì—ê²Œ ì²˜ë¦¬ ê²°ê³¼ í†µë³´\n5. ì¬ë°œ ë°©ì§€ ëŒ€ì±… ìˆ˜ë¦½\n\nê´€ë ¨ ë²•ë ¹: ê°œì¸ì •ë³´ë³´í˜¸ë²• ì œ1ì¡°, ì œ15ì¡°, ì œ17ì¡°, ì œ71ì¡°',
                'ì˜ˆì‚°': 'ì˜ˆì‚° ì†Œìš” ë¯¼ì› ì²˜ë¦¬ ì ˆì°¨ë¥¼ ì•ˆë‚´í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n1. ì˜ˆì‚° ì†Œìš” ê¸ˆì•¡ ì‚°ì •\n2. ì˜ˆì‚° í™•ë³´ ë°©ì•ˆ ê²€í† \n3. ê´€ë ¨ ë¶€ì„œ í˜‘ì˜ ë° ì˜ˆì‚° ë°°ì • ì‹ ì²­\n4. ìƒê¸‰ì ë³´ê³  ë° ìŠ¹ì¸\n5. ì²˜ë¦¬ ì¼ì • ì¡°ì • ë° ë¯¼ì›ì¸ ì•ˆë‚´\n\nê´€ë ¨ ë²•ë ¹: ì§€ë°©ì¬ì •ë²• ì œ2ì¡°, ì œ31ì¡°, ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ9ì¡°'
            };

            const matchedKey = Object.keys(responses).find(key => userMessage.includes(key));
            
            if (matchedKey) {
                return responses[matchedKey];
            }

            return 'ë¯¼ì› ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ë” ì •í™•í•œ ë‹µë³€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì¼ë°˜ì ì¸ ë¯¼ì› ì²˜ë¦¬ ì ˆì°¨:\n1. ë¯¼ì› ë‚´ìš© ê²€í†  ë° ë¶„ë¥˜\n2. ê´€ë ¨ ë¶€ì„œ í˜‘ì˜\n3. ì²˜ë¦¬ ë°©ì•ˆ ìˆ˜ë¦½\n4. ë¯¼ì›ì¸ ë‹µë³€\n5. ì²˜ë¦¬ ì™„ë£Œ ë° ê¸°ë¡\n\nê´€ë ¨ ë²•ë ¹: ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ1ì¡°, ì œ8ì¡°, ì œ9ì¡°';
        }

        // ì„¸ì…˜ ì‚­ì œ
        async function deleteSession(sessionId, event) {
            event.stopPropagation();
            
            if (!confirm('ì´ ëŒ€í™”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                await ChatService.deleteSession(sessionId);
                chatSessions = chatSessions.filter(s => s.id !== sessionId);
                renderChatList();
                
                if (currentSessionId === sessionId) {
                    currentSessionId = null;
                    messages = [];
                    messagesContainer.innerHTML = '';
                    showEmptyState();
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ëŒ€í™”ë¥¼ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
        function showTypingIndicator() {
            const typingEl = document.createElement('div');
            typingEl.className = 'message bot';
            typingEl.id = 'typing-indicator';
            typingEl.innerHTML = `
                <div class="message-content">
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingEl);
            scrollToBottom();
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ìˆ¨ê¸°ê¸°
        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        // ë¹ˆ ìƒíƒœ í‘œì‹œ/ìˆ¨ê¸°ê¸°
        function showEmptyState() {
            emptyState.style.display = 'flex';
        }

        function hideEmptyState() {
            emptyState.style.display = 'none';
        }

        // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ë¹ ë¥¸ ë©”ì‹œì§€ ì„¤ì •
        function setQuickMessage(text) {
            messageInput.value = text;
            messageInput.focus();
        }

        // ì‹œê°„ í¬ë§·íŒ…
        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now.getTime() - date.getTime());
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 1) {
                return 'ì–´ì œ';
            } else if (diffDays < 7) {
                return `${diffDays}ì¼ ì „`;
            } else {
                return date.toLocaleDateString('ko-KR');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        sendBtn.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // í…ìŠ¤íŠ¸ ì˜ì—­ ìë™ ë†’ì´ ì¡°ì •
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // ì´ˆê¸°í™”
        async function init() {
            await loadSessions();
            
            // ì²« ë²ˆì§¸ ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìë™ ì„ íƒ
            if (chatSessions.length > 0) {
                selectSession(chatSessions[0].id);
            }
        }

        // ì±„íŒ… í™”ë©´ì— ë©”ì‹œì§€ ì¶”ê°€ (ì„ì‹œ UIìš©)
        function addMessageToUI(text, sender) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}`;
            messageEl.innerHTML = `
                <div class="message-content">
                    <div class="message-text">${text.replace(/\n/g, '<br>')}</div>
                    <div class="message-time">${new Date().toLocaleTimeString('ko-KR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</div>
                </div>
            `;
            messagesContainer.appendChild(messageEl);
            scrollToBottom();
        }

        // ê²°ê³¼ íŒ¨ë„ í‘œì‹œ
        function showResultPanel() {
            const chatSection = document.getElementById('chatSection');
            const resultPanel = document.getElementById('resultPanel');
            
            chatSection.classList.add('collapsed');
            resultPanel.classList.add('show');
        }

        // ê²°ê³¼ íŒ¨ë„ ìˆ¨ê¸°ê¸°
        function hideResultPanel() {
            const chatSection = document.getElementById('chatSection');
            const resultPanel = document.getElementById('resultPanel');
            
            chatSection.classList.remove('collapsed');
            resultPanel.classList.remove('show');
        }

        // ëª¨ì˜ ë´‡ ì‘ë‹µ ìƒì„± (ì„ì‹œ)
        function generateMockBotResponse(userMessage) {
            const responses = {
                'ë„ë¡œ': 'ë„ë¡œ ë³´ìˆ˜ ìš”ì²­ ë¯¼ì›ì— ëŒ€í•œ ì²˜ë¦¬ ì ˆì°¨ë¥¼ ì•ˆë‚´í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n1. ë¯¼ì› ë‚´ìš© í™•ì¸ ë° í˜„ì¥ ì¡°ì‚¬\n2. ë„ë¡œê´€ë¦¬ê³¼ì™€ í˜‘ì˜\n3. ë³´ìˆ˜ ì¼ì • ìˆ˜ë¦½ (ì¼ë°˜ì ìœ¼ë¡œ 2ì£¼ ì´ë‚´)\n4. ë¯¼ì›ì¸ì—ê²Œ ì²˜ë¦¬ ì¼ì • ì•ˆë‚´\n5. ë³´ìˆ˜ ì™„ë£Œ í›„ ê²°ê³¼ í†µë³´',
                'ê°œì¸ì •ë³´': 'ê°œì¸ì •ë³´ ê´€ë ¨ ë¯¼ì› ì²˜ë¦¬ ì ˆì°¨ë¥¼ ì•ˆë‚´í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n1. ë¯¼ì› ë‚´ìš© ê²€í†  ë° ê°œì¸ì •ë³´ë³´í˜¸ë²• ì ìš© ê²€í† \n2. ê°œì¸ì •ë³´ë³´í˜¸ìœ„ì›íšŒ í˜‘ì˜ (í•„ìš”ì‹œ)\n3. ê´€ë ¨ ë¶€ì„œ ì¡°ì‚¬ ë° ê°œì„  ì¡°ì¹˜\n4. ë¯¼ì›ì¸ì—ê²Œ ì²˜ë¦¬ ê²°ê³¼ í†µë³´\n5. ì¬ë°œ ë°©ì§€ ëŒ€ì±… ìˆ˜ë¦½',
                'ì˜ˆì‚°': 'ì˜ˆì‚° ì†Œìš” ë¯¼ì› ì²˜ë¦¬ ì ˆì°¨ë¥¼ ì•ˆë‚´í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n1. ì˜ˆì‚° ì†Œìš” ê¸ˆì•¡ ì‚°ì •\n2. ì˜ˆì‚° í™•ë³´ ë°©ì•ˆ ê²€í† \n3. ê´€ë ¨ ë¶€ì„œ í˜‘ì˜ ë° ì˜ˆì‚° ë°°ì • ì‹ ì²­\n4. ìƒê¸‰ì ë³´ê³  ë° ìŠ¹ì¸\n5. ì²˜ë¦¬ ì¼ì • ì¡°ì • ë° ë¯¼ì›ì¸ ì•ˆë‚´'
            };

            const matchedKey = Object.keys(responses).find(key => userMessage.includes(key));
            
            if (matchedKey) {
                return responses[matchedKey];
            }

            return 'ë¯¼ì› ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ë” ì •í™•í•œ ë‹µë³€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì¼ë°˜ì ì¸ ë¯¼ì› ì²˜ë¦¬ ì ˆì°¨:\n1. ë¯¼ì› ë‚´ìš© ê²€í†  ë° ë¶„ë¥˜\n2. ê´€ë ¨ ë¶€ì„œ í˜‘ì˜\n3. ì²˜ë¦¬ ë°©ì•ˆ ìˆ˜ë¦½\n4. ë¯¼ì›ì¸ ë‹µë³€\n5. ì²˜ë¦¬ ì™„ë£Œ ë° ê¸°ë¡';
        }

        // ë‹µë³€ ìƒì„± ë²„íŠ¼ ì¶”ê°€
        function addGenerateButton(userMessage, botResponse) {
            const generateBtn = document.createElement('button');
            generateBtn.className = 'generate-btn';
            generateBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ë‹µë³€ ìƒì„±
            `;
            generateBtn.onclick = () => {
                showResultPanel();
                updateResultPanel(userMessage, botResponse);
                generateBtn.remove(); // ë²„íŠ¼ ì œê±°
            };
            
            // ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ë²„íŠ¼ ì¶”ê°€
            messagesContainer.appendChild(generateBtn);
            scrollToBottom();
        }

        // ê²°ê³¼ íŒ¨ë„ ë‚´ìš© ì—…ë°ì´íŠ¸
        function updateResultPanel(userMessage, botResponse) {
            const answerText = document.getElementById('answerText');
            const legalList = document.getElementById('legalList');
            
            // ë‹µë³€ ë‚´ìš© ì—…ë°ì´íŠ¸
            answerText.textContent = botResponse;
            
            // ê´€ë ¨ ë²•ë ¹ ì—…ë°ì´íŠ¸ (ì„ì‹œ)
            const legalItems = getLegalItems(userMessage);
            legalList.innerHTML = legalItems.map(item => `<div>${item}</div>`).join('');
        }

        // ê´€ë ¨ ë²•ë ¹ í•­ëª© ê°€ì ¸ì˜¤ê¸° (ì„ì‹œ)
        function getLegalItems(userMessage) {
            const legalByCategory = {
                'ë„ë¡œ': [
                    'ë„ë¡œë²• ì œ2ì¡° (ë„ë¡œì˜ ì •ì˜)',
                    'ë„ë¡œë²• ì œ19ì¡° (ë„ë¡œì˜ ê´€ë¦¬)',
                    'ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ8ì¡° (ì²˜ë¦¬ê¸°ê°„)'
                ],
                'ê°œì¸ì •ë³´': [
                    'ê°œì¸ì •ë³´ë³´í˜¸ë²• ì œ1ì¡° (ëª©ì )',
                    'ê°œì¸ì •ë³´ë³´í˜¸ë²• ì œ15ì¡° (ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘Â·ì´ìš©)',
                    'ê°œì¸ì •ë³´ë³´í˜¸ë²• ì œ17ì¡° (ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ)',
                    'ê°œì¸ì •ë³´ë³´í˜¸ë²• ì œ71ì¡° (ë¯¼ì›ì²˜ë¦¬)'
                ],
                'ì˜ˆì‚°': [
                    'ì§€ë°©ì¬ì •ë²• ì œ2ì¡° (ì§€ë°©ìì¹˜ë‹¨ì²´ì˜ ì¬ì •ìš´ì˜)',
                    'ì§€ë°©ì¬ì •ë²• ì œ31ì¡° (ì˜ˆì‚°ì˜ í¸ì„±)',
                    'ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ9ì¡° (ì²˜ë¦¬ë°©ë²•)'
                ]
            };

            const matchedKey = Object.keys(legalByCategory).find(key => userMessage.includes(key));
            
            if (matchedKey) {
                return legalByCategory[matchedKey];
            }

            return [
                'ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ1ì¡° (ëª©ì )',
                'ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ8ì¡° (ì²˜ë¦¬ê¸°ê°„)',
                'ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥  ì œ9ì¡° (ì²˜ë¦¬ë°©ë²•)'
            ];
        }

        // í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸° (ìˆ˜ì • ë²„íŠ¼ìœ¼ë¡œë§Œ ê°€ëŠ¥)
        function makeEditable(element) {
            element.contentEditable = true;
            element.classList.add('editing');
            element.focus();
            
            // í¸ì§‘ ì™„ë£Œ ì‹œ ì²˜ë¦¬
            element.onblur = () => {
                element.contentEditable = false;
                element.classList.remove('editing');
            };
            
            // Enter í‚¤ ëˆ„ë¥´ë©´ í¸ì§‘ ì™„ë£Œ
            element.onkeydown = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    element.blur();
                }
            };
        }

        // ì•¡ì…˜ ë²„íŠ¼ í•¨ìˆ˜ë“¤
        function editAnswer() {
            const answerText = document.getElementById('answerText');
            makeEditable(answerText);
        }

        function copyAnswer() {
            const answerText = document.getElementById('answerText');
            const textToCopy = answerText.textContent || answerText.innerText;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // ë³µì‚¬ ì„±ê³µ í”¼ë“œë°±
                const originalText = answerText.innerHTML;
                answerText.style.background = '#10b981';
                answerText.style.color = 'white';
                setTimeout(() => {
                    answerText.style.background = '';
                    answerText.style.color = '';
                }, 500);
                
                console.log('ë‹µë³€ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        function editLegal() {
            const legalList = document.getElementById('legalList');
            makeEditable(legalList);
        }

        function copyLegal() {
            const legalList = document.getElementById('legalList');
            const textToCopy = legalList.textContent || legalList.innerText;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // ë³µì‚¬ ì„±ê³µ í”¼ë“œë°±
                const originalBg = legalList.style.background;
                const originalColor = legalList.style.color;
                legalList.style.background = '#10b981';
                legalList.style.color = 'white';
                setTimeout(() => {
                    legalList.style.background = originalBg;
                    legalList.style.color = originalColor;
                }, 500);
                
                console.log('ê´€ë ¨ ë²•ë ¹ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ë²•ë ¹ ë°ì´í„° (ì˜ˆì‹œ)
        const legalData = {
            categories: [
                {
                    id: 'civil',
                    title: 'ë¯¼ì›ì²˜ë¦¬',
                    desc: 'ë¯¼ì› ì ‘ìˆ˜, ì²˜ë¦¬, ë‹µë³€ ê´€ë ¨ ë²•ë ¹'
                },
                {
                    id: 'personal',
                    title: 'ê°œì¸ì •ë³´',
                    desc: 'ê°œì¸ì •ë³´ ìˆ˜ì§‘, ì´ìš©, ë³´í˜¸ ê´€ë ¨ ë²•ë ¹'
                },
                {
                    id: 'road',
                    title: 'ë„ë¡œê´€ë¦¬',
                    desc: 'ë„ë¡œ ê±´ì„¤, ë³´ìˆ˜, ê´€ë¦¬ ê´€ë ¨ ë²•ë ¹'
                },
                {
                    id: 'budget',
                    title: 'ì˜ˆì‚°ê´€ë¦¬',
                    desc: 'ì˜ˆì‚° í¸ì„±, ì§‘í–‰, ê´€ë¦¬ ê´€ë ¨ ë²•ë ¹'
                }
            ],
            laws: {
                civil: [
                    {
                        id: 'civil_law1',
                        title: 'ë¯¼ì›ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥ ',
                        desc: 'ë¯¼ì›ì˜ ì ‘ìˆ˜, ì²˜ë¦¬ì ˆì°¨, ê¸°ê°„ ë“±ì„ ê·œì •'
                    },
                    {
                        id: 'civil_law2',
                        title: 'í–‰ì •ì ˆì°¨ë²•',
                        desc: 'í–‰ì •ì²­ì˜ ì²˜ë¶„ì ˆì°¨ì™€ ë¯¼ì›ì¸ì˜ ê¶Œë¦¬ ê·œì •'
                    }
                ],
                personal: [
                    {
                        id: 'personal_law1',
                        title: 'ê°œì¸ì •ë³´ë³´í˜¸ë²•',
                        desc: 'ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘, ì´ìš©, ë³´í˜¸ì— ê´€í•œ ì‚¬í•­ ê·œì •'
                    },
                    {
                        id: 'personal_law2',
                        title: 'ì •ë³´í†µì‹ ë§ë²•',
                        desc: 'ì •ë³´í†µì‹ ë§ì„ í†µí•œ ê°œì¸ì •ë³´ ë³´í˜¸ ê·œì •'
                    }
                ],
                road: [
                    {
                        id: 'road_law1',
                        title: 'ë„ë¡œë²•',
                        desc: 'ë„ë¡œì˜ ê±´ì„¤, ê´€ë¦¬, ë³´ì „ì— ê´€í•œ ì‚¬í•­ ê·œì •'
                    },
                    {
                        id: 'road_law2',
                        title: 'ë„ë¡œêµí†µë²•',
                        desc: 'ë„ë¡œì—ì„œì˜ êµí†µ ì•ˆì „ê³¼ ì§ˆì„œ ê·œì •'
                    }
                ],
                budget: [
                    {
                        id: 'budget_law1',
                        title: 'ì§€ë°©ì¬ì •ë²•',
                        desc: 'ì§€ë°©ìì¹˜ë‹¨ì²´ì˜ ì¬ì • ìš´ì˜ì— ê´€í•œ ì‚¬í•­ ê·œì •'
                    },
                    {
                        id: 'budget_law2',
                        title: 'êµ­ê°€ì¬ì •ë²•',
                        desc: 'êµ­ê°€ì˜ ì˜ˆì‚° ë° ê¸°ê¸ˆ ìš´ìš©ì— ê´€í•œ ì‚¬í•­ ê·œì •'
                    }
                ]
            },
            articles: {
                civil_law1: [
                    {
                        id: 'civil_law1_art1',
                        number: 'ì œ1ì¡°',
                        title: 'ëª©ì ',
                        content: 'ì´ ë²•ì€ ë¯¼ì›ì‚¬ë¬´ì˜ ì²˜ë¦¬ì ˆì°¨ì™€ ë°©ë²•ì„ ê·œì •í•˜ì—¬ ë¯¼ì›ì²˜ë¦¬ì˜ ì ì •ì„±ê³¼ ì‹ ì†ì„±ì„ í™•ë³´í•˜ê³  ë¯¼ì›ì¸ì˜ ê¶Œìµì„ ë³´í˜¸í•¨ì„ ëª©ì ìœ¼ë¡œ í•œë‹¤.'
                    },
                    {
                        id: 'civil_law1_art8',
                        number: 'ì œ8ì¡°',
                        title: 'ì²˜ë¦¬ê¸°ê°„',
                        content: 'í–‰ì •ê¸°ê´€ì˜ ì¥ì€ ë¯¼ì›ì„ ì ‘ìˆ˜í•œ ë‚ ë¶€í„° 7ì¼ ì´ë‚´ì— ì²˜ë¦¬í•˜ì—¬ì•¼ í•œë‹¤. ë‹¤ë§Œ, ë¶€ë“ì´í•œ ì‚¬ìœ ë¡œ ì²˜ë¦¬ê¸°ê°„ ë‚´ì— ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ëŠ” ê·¸ ì‚¬ìœ ì™€ ì²˜ë¦¬ì˜ˆì •ì¼ì„ ë¯¼ì›ì¸ì—ê²Œ í†µì§€í•˜ì—¬ì•¼ í•œë‹¤.'
                    },
                    {
                        id: 'civil_law1_art9',
                        number: 'ì œ9ì¡°',
                        title: 'ì²˜ë¦¬ë°©ë²•',
                        content: 'ë¯¼ì›ë‹´ë‹¹ìëŠ” ë¯¼ì›ì„ ì ‘ìˆ˜í•œ ë•Œì—ëŠ” ë¯¼ì›ì¸ì—ê²Œ ì ‘ìˆ˜ì¦ì„ êµë¶€í•˜ê³ , ì²˜ë¦¬ ì™„ë£Œ ì‹œì—ëŠ” ê·¸ ê²°ê³¼ë¥¼ ì§€ì²´ ì—†ì´ ë¯¼ì›ì¸ì—ê²Œ í†µì§€í•˜ì—¬ì•¼ í•œë‹¤.'
                    }
                ],
                personal_law1: [
                    {
                        id: 'personal_law1_art1',
                        number: 'ì œ1ì¡°',
                        title: 'ëª©ì ',
                        content: 'ì´ ë²•ì€ ê°œì¸ì •ë³´ì˜ ì²˜ë¦¬ ë° ë³´í˜¸ì— ê´€í•œ ì‚¬í•­ì„ ê·œì •í•˜ì—¬ ê°œì¸ì˜ ììœ ì™€ ê¶Œë¦¬ë¥¼ ë³´í˜¸í•˜ê³ , ë‚˜ì•„ê°€ ê°œì¸ì˜ ì¡´ì—„ê³¼ ê°€ì¹˜ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•¨ì„ ëª©ì ìœ¼ë¡œ í•œë‹¤.'
                    },
                    {
                        id: 'personal_law1_art15',
                        number: 'ì œ15ì¡°',
                        title: 'ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘Â·ì´ìš©',
                        content: 'ê°œì¸ì •ë³´ì²˜ë¦¬ìëŠ” ì •ë³´ì£¼ì²´ì˜ ë™ì˜ë¥¼ ë°›ì•„ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤. ë‹¤ë§Œ, ë²•ë¥ ì— íŠ¹ë³„í•œ ê·œì •ì´ ìˆê±°ë‚˜ ë²•ë ¹ìƒ ì˜ë¬´ë¥¼ ì¤€ìˆ˜í•˜ê¸° ìœ„í•˜ì—¬ ë¶ˆê°€í”¼í•œ ê²½ìš°ì—ëŠ” ì •ë³´ì£¼ì²´ì˜ ë™ì˜ ì—†ì´ë„ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤.'
                    },
                    {
                        id: 'personal_law1_art71',
                        number: 'ì œ71ì¡°',
                        title: 'ë¯¼ì›ì²˜ë¦¬',
                        content: 'ê°œì¸ì •ë³´ì²˜ë¦¬ìëŠ” ê°œì¸ì •ë³´ ì²˜ë¦¬ì— ê´€í•œ ë¯¼ì›ì„ ììœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•˜ì—¬ í•„ìš”í•œ ì ˆì°¨ë¥¼ ë§ˆë ¨í•˜ê³  ë¯¼ì›ì²˜ë¦¬ ë‹´ë‹¹ìë¥¼ ì§€ì •í•˜ì—¬ì•¼ í•œë‹¤.'
                    }
                ],
                road_law1: [
                    {
                        id: 'road_law1_art2',
                        number: 'ì œ2ì¡°',
                        title: 'ë„ë¡œì˜ ì •ì˜',
                        content: 'ì´ ë²•ì—ì„œ "ë„ë¡œ"ë€ ì¼ë°˜ì˜ êµí†µì— ì‚¬ìš©ë˜ëŠ” ë„ë¡œë¡œì„œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ë¶„í•œë‹¤. 1. ê³ ì†êµ­ë„ 2. ì¼ë°˜êµ­ë„ 3. íŠ¹ë³„ì‹œë„Â·ê´‘ì—­ì‹œë„ 4. ì§€ë°©ë„ 5. ì‹œë„ 6. êµ°ë„ 7. êµ¬ë„'
                    },
                    {
                        id: 'road_law1_art19',
                        number: 'ì œ19ì¡°',
                        title: 'ë„ë¡œì˜ ê´€ë¦¬',
                        content: 'ë„ë¡œê´€ë¦¬ì²­ì€ ë„ë¡œë¥¼ ì–‘í˜¸í•œ ìƒíƒœë¡œ ìœ ì§€í•˜ê³  ì•ˆì „í•˜ê³  ì›í™œí•œ êµí†µì„ í™•ë³´í•˜ê¸° ìœ„í•˜ì—¬ ë„ë¡œì˜ ì‹ ì„¤Â·ê°œëŸ‰Â·ìœ ì§€Â·ë³´ìˆ˜ ë° ê·¸ ë°–ì˜ ê´€ë¦¬ë¥¼ í•˜ì—¬ì•¼ í•œë‹¤.'
                    }
                ],
                budget_law1: [
                    {
                        id: 'budget_law1_art2',
                        number: 'ì œ2ì¡°',
                        title: 'ì§€ë°©ìì¹˜ë‹¨ì²´ì˜ ì¬ì •ìš´ì˜',
                        content: 'ì§€ë°©ìì¹˜ë‹¨ì²´ëŠ” ê·¸ ì¬ì •ì„ ìˆ˜ì…ê³¼ ì§€ì¶œì˜ ê· í˜•ì„ ìœ ì§€í•˜ë©° ê±´ì „í•˜ê²Œ ìš´ì˜í•˜ì—¬ì•¼ í•˜ê³ , êµ­ê°€ì˜ ì •ì±…ëª©í‘œì— ë¶€í•©í•˜ë„ë¡ ë…¸ë ¥í•˜ì—¬ì•¼ í•œë‹¤.'
                    },
                    {
                        id: 'budget_law1_art31',
                        number: 'ì œ31ì¡°',
                        title: 'ì˜ˆì‚°ì˜ í¸ì„±',
                        content: 'ì§€ë°©ìì¹˜ë‹¨ì²´ì˜ ì¥ì€ ëŒ€í†µë ¹ë ¹ìœ¼ë¡œ ì •í•˜ëŠ” ë°”ì— ë”°ë¼ ë§¤ë…„ë„ ì˜ˆì‚°ì•ˆì„ í¸ì„±í•˜ì—¬ íšŒê³„ì—°ë„ ê°œì‹œ 90ì¼ ì „ê¹Œì§€ ì§€ë°©ì˜íšŒì— ì œì¶œí•˜ì—¬ì•¼ í•œë‹¤.'
                    }
                ]
            }
        };

        // ë²•ë ¹ ì„ íƒ íŒ¨ë„ ì—´ê¸°
        function openLegalSelector() {
            currentLegalStep = 'category';
            // ê¸°ì¡´ ì„ íƒì‚¬í•­ ìœ ì§€í•˜ì§€ ì•Šê³  ì´ˆê¸°í™”
            selectedCategories = [];
            selectedLaws = {};
            selectedArticles = {};
            showCategorySelection();
            document.getElementById('legalSelectorOverlay').classList.add('show');
            document.getElementById('legalSelectorPanel').classList.add('show');
        }

        // ë²•ë ¹ ì„ íƒ íŒ¨ë„ ë‹«ê¸°
        function closeLegalSelector() {
            document.getElementById('legalSelectorOverlay').classList.remove('show');
            document.getElementById('legalSelectorPanel').classList.remove('show');
        }

        // ì§€ì¹¨(ì¹´í…Œê³ ë¦¬) ì„ íƒ í™”ë©´ í‘œì‹œ
        function showCategorySelection() {
            const title = document.getElementById('legalSelectorTitle');
            const content = document.getElementById('legalSelectorContent');
            const footer = document.getElementById('legalSelectorFooter');

            title.textContent = 'ì§€ì¹¨ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)';
            
            content.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: #f0f9ff; border-radius: 6px; font-size: 0.85rem; color: #0369a1;">
                    ğŸ’¡ ì—¬ëŸ¬ ì§€ì¹¨ì„ ë™ì‹œì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„ íƒëœ ì§€ì¹¨ì€ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                <div class="legal-category-grid">
                    ${legalData.categories.map(category => {
                        const isSelected = selectedCategories.includes(category.id);
                        return `
                            <div class="legal-category-item ${isSelected ? 'selected' : ''}" onclick="toggleCategory('${category.id}')">
                                <div class="legal-category-title">${category.title}</div>
                                <div class="legal-category-desc">${category.desc}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            footer.innerHTML = `
                <button class="footer-btn primary" onclick="proceedToLawSelection()" ${selectedCategories.length === 0 ? 'disabled' : ''}>ë‹¤ìŒ (${selectedCategories.length}ê°œ ì„ íƒë¨)</button>
                <button class="footer-btn secondary" onclick="closeLegalSelector()">ë‹«ê¸°</button>
            `;
        }

        // ì¹´í…Œê³ ë¦¬ í† ê¸€ (ë‹¤ì¤‘ ì„ íƒ)
        function toggleCategory(categoryId) {
            const index = selectedCategories.indexOf(categoryId);
            if (index > -1) {
                selectedCategories.splice(index, 1);
                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì„ íƒëœ ë²•ë ¹ë“¤ë„ ì œê±°
                delete selectedLaws[categoryId];
                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ì†í•œ ë²•ë ¹ë“¤ì˜ ì„ íƒëœ ì¡°í•­ë“¤ë„ ì œê±°
                const categoryLaws = legalData.laws[categoryId] || [];
                categoryLaws.forEach(law => {
                    delete selectedArticles[law.id];
                });
            } else {
                selectedCategories.push(categoryId);
                selectedLaws[categoryId] = [];
            }
            
            // UI ì—…ë°ì´íŠ¸
            updateCategoryDisplay();
            updateCategoryFooter();
        }

        // ì¹´í…Œê³ ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateCategoryDisplay() {
            const categoryItems = document.querySelectorAll('.legal-category-item');
            categoryItems.forEach((item, index) => {
                const categoryId = legalData.categories[index].id;
                if (selectedCategories.includes(categoryId)) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // ì¹´í…Œê³ ë¦¬ ì„ íƒ í‘¸í„° ì—…ë°ì´íŠ¸
        function updateCategoryFooter() {
            const footer = document.getElementById('legalSelectorFooter');
            footer.innerHTML = `
                <button class="footer-btn primary" onclick="proceedToLawSelection()" ${selectedCategories.length === 0 ? 'disabled' : ''}>ë‹¤ìŒ (${selectedCategories.length}ê°œ ì„ íƒë¨)</button>
                <button class="footer-btn secondary" onclick="closeLegalSelector()">ë‹«ê¸°</button>
            `;
        }

        // ë²•ë ¹ ì„ íƒ ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToLawSelection() {
            if (selectedCategories.length === 0) {
                alert('ì„ íƒëœ ì§€ì¹¨ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            currentLegalStep = 'laws';
            showLawSelection();
        }

        // ë²•ë ¹ ì„ íƒ í™”ë©´ í‘œì‹œ
        function showLawSelection() {
            const title = document.getElementById('legalSelectorTitle');
            const content = document.getElementById('legalSelectorContent');
            const footer = document.getElementById('legalSelectorFooter');

            title.textContent = 'ë²•ë ¹ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)';
            
            let allLaws = [];
            selectedCategories.forEach(categoryId => {
                const categoryLaws = legalData.laws[categoryId] || [];
                const categoryTitle = legalData.categories.find(c => c.id === categoryId)?.title || '';
                categoryLaws.forEach(law => {
                    allLaws.push({
                        ...law,
                        categoryId: categoryId,
                        categoryTitle: categoryTitle
                    });
                });
            });

            content.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: #f0f9ff; border-radius: 6px; font-size: 0.85rem; color: #0369a1;">
                    ğŸ’¡ ì—¬ëŸ¬ ë²•ë ¹ì„ ë™ì‹œì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„ íƒëœ ë²•ë ¹ì€ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                <div>
                    ${allLaws.map(law => {
                        const isSelected = selectedLaws[law.categoryId] && selectedLaws[law.categoryId].includes(law.id);
                        return `
                            <div class="legal-list-item ${isSelected ? 'selected' : ''}" onclick="toggleLaw('${law.categoryId}', '${law.id}')">
                                <div class="legal-category-tag" style="font-size: 0.75rem; color: #6b7280; margin-bottom: 4px;">${law.categoryTitle}</div>
                                <div class="legal-item-title">${law.title}</div>
                                <div class="legal-item-desc">${law.desc}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            const totalSelectedLaws = Object.values(selectedLaws).reduce((total, laws) => total + laws.length, 0);
            footer.innerHTML = `
                <button class="footer-btn secondary" onclick="showCategorySelection()">ë’¤ë¡œê°€ê¸°</button>
                <button class="footer-btn primary" onclick="proceedToArticleSelection()" ${totalSelectedLaws === 0 ? 'disabled' : ''}>ë‹¤ìŒ (${totalSelectedLaws}ê°œ ì„ íƒë¨)</button>
                <button class="footer-btn secondary" onclick="closeLegalSelector()">ë‹«ê¸°</button>
            `;
        }

        // ë²•ë ¹ í† ê¸€ (ë‹¤ì¤‘ ì„ íƒ)
        function toggleLaw(categoryId, lawId) {
            if (!selectedLaws[categoryId]) {
                selectedLaws[categoryId] = [];
            }
            
            const index = selectedLaws[categoryId].indexOf(lawId);
            if (index > -1) {
                selectedLaws[categoryId].splice(index, 1);
                // í•´ë‹¹ ë²•ë ¹ì˜ ì„ íƒëœ ì¡°í•­ë“¤ë„ ì œê±°
                delete selectedArticles[lawId];
            } else {
                selectedLaws[categoryId].push(lawId);
                selectedArticles[lawId] = [];
            }
            
            // UI ì—…ë°ì´íŠ¸
            updateLawDisplay();
            updateLawFooter();
        }

        // ë²•ë ¹ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateLawDisplay() {
            const lawItems = document.querySelectorAll('.legal-list-item');
            lawItems.forEach(item => {
                const onclickAttr = item.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/toggleLaw\('([^']+)',\s*'([^']+)'\)/);
                    if (match) {
                        const categoryId = match[1];
                        const lawId = match[2];
                        const isSelected = selectedLaws[categoryId] && selectedLaws[categoryId].includes(lawId);
                        if (isSelected) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }
                    }
                }
            });
        }

        // ë²•ë ¹ ì„ íƒ í‘¸í„° ì—…ë°ì´íŠ¸
        function updateLawFooter() {
            const footer = document.getElementById('legalSelectorFooter');
            const totalSelectedLaws = Object.values(selectedLaws).reduce((total, laws) => total + laws.length, 0);
            footer.innerHTML = `
                <button class="footer-btn secondary" onclick="showCategorySelection()">ë’¤ë¡œê°€ê¸°</button>
                <button class="footer-btn primary" onclick="proceedToArticleSelection()" ${totalSelectedLaws === 0 ? 'disabled' : ''}>ë‹¤ìŒ (${totalSelectedLaws}ê°œ ì„ íƒë¨)</button>
                <button class="footer-btn secondary" onclick="closeLegalSelector()">ë‹«ê¸°</button>
            `;
        }

        // ì¡°í•­ ì„ íƒ ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToArticleSelection() {
            const totalSelectedLaws = Object.values(selectedLaws).reduce((total, laws) => total + laws.length, 0);
            if (totalSelectedLaws === 0) {
                alert('ì„ íƒëœ ë²•ë ¹ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            currentLegalStep = 'articles';
            showArticleSelection();
        }

        // ì¡°í•­ ì„ íƒ í™”ë©´ í‘œì‹œ
        function showArticleSelection() {
            const title = document.getElementById('legalSelectorTitle');
            const content = document.getElementById('legalSelectorContent');
            const footer = document.getElementById('legalSelectorFooter');

            title.textContent = 'ì¡°í•­ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)';
            
            let allArticles = [];
            Object.keys(selectedLaws).forEach(categoryId => {
                const categoryLaws = selectedLaws[categoryId];
                categoryLaws.forEach(lawId => {
                    const law = legalData.laws[categoryId]?.find(l => l.id === lawId);
                    const articles = legalData.articles[lawId] || [];
                    articles.forEach(article => {
                        allArticles.push({
                            ...article,
                            lawId: lawId,
                            lawTitle: law?.title || '',
                            categoryId: categoryId
                        });
                    });
                });
            });

            content.innerHTML = `
                <div>
                    <div style="margin-bottom: 15px; padding: 10px; background: #f0f9ff; border-radius: 6px; font-size: 0.85rem; color: #0369a1;">
                        ğŸ’¡ ì—¬ëŸ¬ ì¡°í•­ì„ ë™ì‹œì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„ íƒëœ ì¡°í•­ì€ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                    ${allArticles.map(article => {
                        const isSelected = selectedArticles[article.lawId] && selectedArticles[article.lawId].includes(article.id);
                        return `
                            <div class="legal-article-item ${isSelected ? 'selected' : ''}" onclick="toggleArticleNew('${article.lawId}', '${article.id}')">
                                <div class="legal-category-tag" style="font-size: 0.75rem; color: #6b7280; margin-bottom: 4px;">${article.lawTitle}</div>
                                <div class="legal-article-number">${article.number} (${article.title})</div>
                                <div class="legal-article-text">${article.content}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            const totalSelectedArticles = Object.values(selectedArticles).reduce((total, articles) => total + articles.length, 0);
            footer.innerHTML = `
                <button class="footer-btn secondary" onclick="showLawSelection()">ë’¤ë¡œê°€ê¸°</button>
                <button class="footer-btn primary" onclick="applySelectedArticles()">ì ìš© (${totalSelectedArticles}ê°œ ì„ íƒë¨)</button>
                <button class="footer-btn secondary" onclick="closeLegalSelector()">ë‹«ê¸°</button>
            `;
        }

        // ìƒˆë¡œìš´ ì¡°í•­ ì„ íƒ/í•´ì œ (ë²•ë ¹ë³„ ê´€ë¦¬)
        function toggleArticleNew(lawId, articleId) {
            if (!selectedArticles[lawId]) {
                selectedArticles[lawId] = [];
            }
            
            const index = selectedArticles[lawId].indexOf(articleId);
            if (index > -1) {
                selectedArticles[lawId].splice(index, 1);
            } else {
                selectedArticles[lawId].push(articleId);
            }
            
            // UI ì—…ë°ì´íŠ¸
            updateArticleDisplay();
            updateArticleFooter();
        }

        // ì¡°í•­ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateArticleDisplay() {
            const articleItems = document.querySelectorAll('.legal-article-item');
            articleItems.forEach(item => {
                const onclickAttr = item.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/toggleArticleNew\('([^']+)',\s*'([^']+)'\)/);
                    if (match) {
                        const lawId = match[1];
                        const articleId = match[2];
                        const isSelected = selectedArticles[lawId] && selectedArticles[lawId].includes(articleId);
                        if (isSelected) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }
                    }
                }
            });
        }

        // ì¡°í•­ ì„ íƒ í‘¸í„° ì—…ë°ì´íŠ¸
        function updateArticleFooter() {
            const footer = document.getElementById('legalSelectorFooter');
            const totalSelectedArticles = Object.values(selectedArticles).reduce((total, articles) => total + articles.length, 0);
            footer.innerHTML = `
                <button class="footer-btn secondary" onclick="showLawSelection()">ë’¤ë¡œê°€ê¸°</button>
                <button class="footer-btn primary" onclick="applySelectedArticles()">ì ìš© (${totalSelectedArticles}ê°œ ì„ íƒë¨)</button>
                <button class="footer-btn secondary" onclick="closeLegalSelector()">ë‹«ê¸°</button>
            `;
        }

        // ê¸°ì¡´ í•¨ìˆ˜ (í•˜ìœ„ í˜¸í™˜ì„±)
        function toggleArticle(articleId) {
            const articleElement = event.target.closest('.legal-article-item');
            const index = selectedArticles.indexOf(articleId);
            
            if (index > -1) {
                selectedArticles.splice(index, 1);
                articleElement.classList.remove('selected');
            } else {
                selectedArticles.push(articleId);
                articleElement.classList.add('selected');
            }
            
            // ì‹¤ì‹œê°„ìœ¼ë¡œ ì„ íƒ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            updateApplyButtonText();
        }

        // ì ìš© ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateApplyButtonText() {
            const applyButton = document.querySelector('.footer-btn.primary');
            if (applyButton) {
                applyButton.textContent = `ì ìš© (${selectedArticles.length}ê°œ ì„ íƒë¨)`;
            }
        }

        // ì„ íƒëœ ì¡°í•­ë“¤ì„ ê´€ë ¨ ë²•ë ¹ì— ì ìš©
        function applySelectedArticles() {
            const totalSelectedArticles = Object.values(selectedArticles).reduce((total, articles) => total + articles.length, 0);
            if (totalSelectedArticles === 0) {
                alert('ì„ íƒëœ ì¡°í•­ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const legalList = document.getElementById('legalList');
            const selectedArticleTexts = [];

            // ë²•ë ¹ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ì„ íƒëœ ì¡°í•­ë“¤ ìˆ˜ì§‘
            Object.keys(selectedArticles).forEach(lawId => {
                const articleIds = selectedArticles[lawId];
                if (articleIds.length > 0) {
                    // ë²•ë ¹ ì •ë³´ ì°¾ê¸°
                    let lawTitle = '';
                    Object.keys(legalData.laws).forEach(categoryId => {
                        const law = legalData.laws[categoryId]?.find(l => l.id === lawId);
                        if (law) {
                            lawTitle = law.title;
                        }
                    });

                    // ê° ì¡°í•­ ì¶”ê°€
                    articleIds.forEach(articleId => {
                        const article = legalData.articles[lawId]?.find(a => a.id === articleId);
                        if (article) {
                            selectedArticleTexts.push(`[${lawTitle}] ${article.number} ${article.title}: ${article.content}`);
                        }
                    });
                }
            });

            legalList.innerHTML = selectedArticleTexts.map(text => `<div style="margin-bottom: 10px; padding: 8px; border-left: 3px solid #667eea;">${text}</div>`).join('');
            closeLegalSelector();
            
            // ì„±ê³µ ë©”ì‹œì§€
            const legalSection = legalList.closest('.answer-section');
            const originalBg = legalSection.style.background;
            legalSection.style.background = '#f0f9ff';
            setTimeout(() => {
                legalSection.style.background = originalBg;
            }, 1000);
        }

        // ê´€ë ¨ ë²•ë ¹ ìˆ˜ì • í•¨ìˆ˜ ì—…ë°ì´íŠ¸
        function editLegal() {
            openLegalSelector();
        }

        // ì•± ì‹œì‘
        init();
    </script>
</body>
</html>
