# ë¯¼ì›ì²˜ë¦¬ ì±—ë´‡ ì‹œìŠ¤í…œ ë¶„ì„ ë¬¸ì„œ

---

## [1ë‹¨ê³„] ì‹œìŠ¤í…œ ê°œìš” - í•œëˆˆì— ë³´ê¸°

### ğŸ¯ ì´ ì‹œìŠ¤í…œì´ ë­”ê°€ìš”?

**ê³µë¬´ì›ë“¤ì´ ë¯¼ì›ì„ ì²˜ë¦¬í•  ë•Œ ë„ì›€ì„ ì£¼ëŠ” AI ì±—ë´‡ ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤.
ë¯¼ì› ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ ChatGPTì²˜ëŸ¼ ë‹µë³€ì„ ì œê³µí•˜ê³ , ê´€ë ¨ ë²•ë¥ ê³¼ ê³µì‹ ë‹µë³€ ì–‘ì‹ê¹Œì§€ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤ë‹ˆë‹¤.

---

### ğŸ—ï¸ ì „ì²´ êµ¬ì¡° í•œëˆˆì— ë³´ê¸° (ìµœì‹  - í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì (ê³µë¬´ì›)    â”‚
â”‚   ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ    â”‚
â”‚   ì±—ë´‡ ì‚¬ìš©         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     í”„ë¡ íŠ¸ì—”ë“œ (í™”ë©´)            â”‚
â”‚  - ì±„íŒ… ì¸í„°í˜ì´ìŠ¤              â”‚
â”‚  - ì±„íŒ… ê¸°ë¡ ì‚¬ì´ë“œë°”           â”‚
â”‚  - Reactë¡œ ë§Œë“  ì›¹í˜ì´ì§€        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ë°±ì—”ë“œ (ì²˜ë¦¬ ì„œë²„)                       â”‚
â”‚  - ë©”ì‹œì§€ ì²˜ë¦¬                              â”‚
â”‚  - FAQ í•˜ì´ë¸Œë¦¬ë“œ ë§¤ì¹­ (Dify + ë¡œì»¬)        â”‚
â”‚  - AI ì—°ê²°                                  â”‚
â”‚  - Python Flask ì„œë²„                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ì™¸ë¶€ ì„œë¹„ìŠ¤ & ë°ì´í„°                     â”‚
â”‚  - Dify Knowledge (FAQ + ë²•ë ¹ DB)          â”‚
â”‚  - OpenAI (GPT-4o-mini)                    â”‚
â”‚  - ë¡œì»¬ faq_topic.xlsx (ë§¤í•‘ í…Œì´ë¸”)        â”‚
â”‚  - Supabase (ë°ì´í„° ì €ì¥ì†Œ)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ”§ ì‚¬ìš©ëœ ê¸°ìˆ 

#### í”„ë¡ íŠ¸ì—”ë“œ (í™”ë©´)
- **React 18.2.0** - ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ í”„ë ˆì„ì›Œí¬
- **TypeScript 4.9.0** - íƒ€ì… ì•ˆì „ì„±ì„ ì œê³µí•˜ëŠ” JavaScript
- **Supabase JS 2.56.0** - ë°ì´í„°ë² ì´ìŠ¤ í´ë¼ì´ì–¸íŠ¸
- **react-scripts 5.0.1** - ë¹Œë“œ ë„êµ¬

#### ë°±ì—”ë“œ (ì„œë²„)
- **Python 3.13** - í”„ë¡œê·¸ë˜ë° ì–¸ì–´
- **Flask 3.1.2** - ì›¹ ì„œë²„ í”„ë ˆì„ì›Œí¬
- **OpenAI API** - GPT-4o-mini ëª¨ë¸ ì‚¬ìš©
- **Dify Knowledge** - RAG ê¸°ë°˜ ë¬¸ì„œ ê²€ìƒ‰
- **pandas** - FAQ ë§¤í•‘ í…Œì´ë¸” ì²˜ë¦¬
- **uv** - íŒ¨í‚¤ì§€ ê´€ë¦¬ ë„êµ¬

#### ë°ì´í„° ì €ì¥
- **Dify Knowledge** - FAQ 102ê°œ + ë²•ë ¹ ë¬¸ì„œ (Vector DB)
- **ë¡œì»¬ faq_topic.xlsx** - FAQ policy_anchor ë§¤í•‘ í…Œì´ë¸”
- **Supabase (PostgreSQL)** - ì±„íŒ… ê¸°ë¡ ì €ì¥
- **ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ** - ë¡œê·¸ ë° ì°¸ê³  ë¬¸ì„œ

---

### ğŸ“ ì£¼ìš” í´ë” ì„¤ëª…

```
test_dify/
â”‚
â”œâ”€â”€ src/                          # í”„ë¡ íŠ¸ì—”ë“œ ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ components/               # í™”ë©´ êµ¬ì„± ìš”ì†Œ
â”‚   â”‚   â”œâ”€â”€ Chatbot.tsx          # ì±„íŒ… í™”ë©´
â”‚   â”‚   â””â”€â”€ ChatSidebar.tsx      # ì±„íŒ… ê¸°ë¡ ëª©ë¡
â”‚   â”œâ”€â”€ services/                # ë°ì´í„° ì²˜ë¦¬ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ chatService.ts       # ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™
â”‚   â”‚   â””â”€â”€ chatbotService.ts    # AI ì‘ë‹µ ì²˜ë¦¬
â”‚   â””â”€â”€ lib/                     # ìœ í‹¸ë¦¬í‹°
â”‚       â””â”€â”€ supabase.ts          # ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
â”‚
â”œâ”€â”€ fund/                         # ë°±ì—”ë“œ ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ app.py                   # Flask ì„œë²„ ë©”ì¸ íŒŒì¼ (í•˜ì´ë¸Œë¦¬ë“œ RAG)
â”‚   â”œâ”€â”€ design/                  # ëŒ€ì²´ UI (HTML/CSS/JS)
â”‚   â”œâ”€â”€ logs/                    # ì„œë²„ ë¡œê·¸ íŒŒì¼
â”‚   â””â”€â”€ .env                     # í™˜ê²½ ë³€ìˆ˜ (API í‚¤, Dify ì„¤ì •)
â”‚
â”œâ”€â”€ data/                         # ì°¸ê³  ìë£Œ
â”‚   â”œâ”€â”€ faq_topic.xlsx           # FAQ ë§¤í•‘ í…Œì´ë¸” (102ê°œ)
â”‚   â”œâ”€â”€ faq_markdown/            # FAQ Markdown íŒŒì¼ (Dify ì—…ë¡œë“œìš©)
â”‚   â””â”€â”€ (ë²•ë¥ , ê·œì • ë¬¸ì„œë“¤)
â”‚
â”œâ”€â”€ scripts/                      # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ convert_faq_for_dify.py  # FAQ Excel â†’ Markdown ë³€í™˜
â”‚
â”œâ”€â”€ public/                       # ì •ì  íŒŒì¼
â”‚   â””â”€â”€ index.html               # HTML ì§„ì…ì 
â”‚
â”œâ”€â”€ plan.md                       # ì´ ë¬¸ì„œ
â””â”€â”€ DIFY_RAG_SETUP.md            # Dify ì„¤ì • ê°€ì´ë“œ
```

#### ê° í´ë”ê°€ í•˜ëŠ” ì¼

| í´ë” | ì—­í•  |
|------|------|
| **src/components/** | ì‚¬ìš©ìê°€ ë³´ëŠ” í™”ë©´ (ì±„íŒ…ì°½, ì‚¬ì´ë“œë°” ë“±) |
| **src/services/** | ì„œë²„ì™€ í†µì‹ , ë°ì´í„° ì²˜ë¦¬ |
| **fund/app.py** | FAQ í•˜ì´ë¸Œë¦¬ë“œ ë§¤ì¹­ + Dify RAG + ë‹µë³€ ìƒì„± |
| **fund/design/** | ChatGPT ìŠ¤íƒ€ì¼ì˜ ëŒ€ì²´ UI |
| **fund/logs/** | ì„œë²„ ë™ì‘ ê¸°ë¡, ì—ëŸ¬ ì¶”ì  |
| **data/faq_topic.xlsx** | FAQ policy_anchor ë§¤í•‘ í…Œì´ë¸” |
| **data/faq_markdown/** | Difyì— ì—…ë¡œë“œí•  FAQ Markdown íŒŒì¼ |
| **scripts/** | FAQ ë³€í™˜ ë“± ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸ |

---
---

## [2ë‹¨ê³„] ê°œë°œììš© êµ¬ì¡° ì„¤ëª…

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ìƒì„¸ (í•˜ì´ë¸Œë¦¬ë“œ RAG ë°©ì‹)

#### Multi-tier Architecture with Hybrid RAG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Presentation Layer                     â”‚
â”‚                  (í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ React Components (Chatbot, ChatSidebar)              â”‚
â”‚  â€¢ TypeScript Type Definitions                          â”‚
â”‚  â€¢ CSS Styling                                          â”‚
â”‚  â€¢ User Input/Output Handling                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP REST API (JSON)
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Backend Layer                          â”‚
â”‚                 (í•˜ì´ë¸Œë¦¬ë“œ RAG ë¡œì§)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Flask Application (app.py)                             â”‚
â”‚  â€¢ Routes: /, /api/chat, /api/new-session              â”‚
â”‚  â€¢ FAQ Hybrid Matching Logic                            â”‚
â”‚    â”œâ”€ Dify Knowledge: FAQ Semantic Search              â”‚
â”‚    â”œâ”€ Local Mapping: faq_id â†’ policy_anchor            â”‚
â”‚    â””â”€ Dify Knowledge: Policy Document Search           â”‚
â”‚  â€¢ Session Management (in-memory)                       â”‚
â”‚  â€¢ Logging System                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ API Calls
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               External Services Layer                    â”‚
â”‚               (ì™¸ë¶€ ì„œë¹„ìŠ¤ ê³„ì¸µ)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Dify Knowledge API                                   â”‚
â”‚    â”œâ”€ FAQ Vector DB (102ê°œ)                            â”‚
â”‚    â””â”€ Policy Document Vector DB (ë²•ë ¹/ê·œì •)             â”‚
â”‚  â€¢ OpenAI API (GPT-4o-mini)                             â”‚
â”‚  â€¢ Local Data                                           â”‚
â”‚    â””â”€ faq_topic.xlsx (policy_anchor ë§¤í•‘)               â”‚
â”‚  â€¢ Supabase PostgreSQL Database                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### í•µì‹¬: í•˜ì´ë¸Œë¦¬ë“œ RAG ë°©ì‹

#### ì™œ í•˜ì´ë¸Œë¦¬ë“œì¸ê°€?

```
Difyë§Œ ì‚¬ìš©í•  ê²½ìš°:
  âœ… FAQ ê²€ìƒ‰ ì •í™•ë„ ë†’ìŒ (80-90%)
  âŒ policy_anchorë¥¼ ì •í™•íˆ ì¶”ì¶œí•˜ê¸° ì–´ë ¤ì›€ (LLM í™˜ê° ê°€ëŠ¥ì„±)

ë¡œì»¬ë§Œ ì‚¬ìš©í•  ê²½ìš°:
  âŒ FAQ ë§¤ì¹­ ì •í™•ë„ ë‚®ìŒ (60-70%, í‚¤ì›Œë“œ ë§¤ì¹­)
  âœ… policy_anchor ì •í™•ë„ 100%

í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹:
  âœ… Difyë¡œ FAQ ê²€ìƒ‰ (ì •í™•ë„ ë†’ìŒ)
  âœ… ë¡œì»¬ ë§¤í•‘ìœ¼ë¡œ policy_anchor ë³´ì¥ (ì •í™•ë„ 100%)
  âœ… Difyë¡œ ë²•ë ¹ ë¬¸ì„œ ê²€ìƒ‰
  â†’ ìµœê³ ì˜ ì •í™•ë„!
```

---

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ë° ì—­í• 

#### 1. í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„´íŠ¸ (ë³€ê²½ ì—†ìŒ)

##### Chatbot.tsx (`src/components/Chatbot.tsx`)
**ì—­í• **: ë©”ì¸ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤
- ë©”ì‹œì§€ ëª©ë¡ ë Œë”ë§
- ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
- AI ì‘ë‹µ ë¡œë”© ìƒíƒœ í‘œì‹œ
- ìë™ ìŠ¤í¬ë¡¤ ê¸°ëŠ¥
- ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ ì œê³µ

##### ChatSidebar.tsx (`src/components/ChatSidebar.tsx`)
**ì—­í• **: ì±„íŒ… ì„¸ì…˜ ê´€ë¦¬ ì‚¬ì´ë“œë°”
- ì„¸ì…˜ ëª©ë¡ í‘œì‹œ
- ìƒˆ ì„¸ì…˜ ìƒì„±
- ì„¸ì…˜ ì„ íƒ/ì‚­ì œ

#### 2. ë°±ì—”ë“œ ë ˆì´ì–´ (í•˜ì´ë¸Œë¦¬ë“œ RAG ì¶”ê°€)

##### Flask Application (`fund/app.py`)

**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸**:

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ê¸°ëŠ¥ | ìš”ì²­ | ì‘ë‹µ |
|-----------|--------|------|------|------|
| `/` | GET | HTML í˜ì´ì§€ ì œê³µ | - | index.html |
| `/api/chat` | POST | í•˜ì´ë¸Œë¦¬ë“œ RAG ì²˜ë¦¬ | `{message, session_id}` | `{success, message, related_laws, matched_faq_id}` |
| `/api/new-session` | POST | ìƒˆ ì„¸ì…˜ ìƒì„± | - | `{session_id}` |

**í•µì‹¬ í•¨ìˆ˜**:

1. **call_dify_knowledge(query, top_k)**
   - Dify Knowledge API í˜¸ì¶œ
   - FAQ ë˜ëŠ” ë²•ë ¹ ë¬¸ì„œ ê²€ìƒ‰
   - Semantic search ì‚¬ìš©

2. **extract_faq_id_from_content(record)**
   - Dify ê²€ìƒ‰ ê²°ê³¼ì—ì„œ faq_id ì¶”ì¶œ
   - Metadata ë˜ëŠ” ì •ê·œì‹ ì‚¬ìš©

3. **get_policy_anchor(faq_id)**
   - ë¡œì»¬ faq_topic.xlsxì—ì„œ ë§¤í•‘
   - faq_id â†’ policy_anchor
   - **ì •í™•ë„ 100% ë³´ì¥**

4. **generate_answer_with_context(user_message, faq_content, policy_docs)**
   - FAQ ë‹µë³€ + ë²•ë ¹ ë¬¸ì„œë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì‚¬ìš©
   - OpenAI GPT-4o-minië¡œ ìµœì¢… ë‹µë³€ ìƒì„±

---

### ì™¸ë¶€ ì—°ë™ ì‹œìŠ¤í…œ

#### 1. Dify Knowledge API ì—°ë™

**ì—”ë“œí¬ì¸íŠ¸**:
```
http://112.173.179.199:5001/v1/datasets/{dataset_id}/retrieve
```

**ë‘ ê°€ì§€ Dataset**:

| Dataset | ë‚´ìš© | ìš©ë„ |
|---------|------|------|
| **FAQ Dataset** | faq_topic.xlsx 102ê°œ FAQ | FAQ ê²€ìƒ‰ (semantic search) |
| **Policy Dataset** | ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ì§€ì¹¨, ì‚¬ì—…ë¹„ ì‚°ì • ì§€ì¹¨ ë“± | ë²•ë ¹ ë¬¸ì„œ ê²€ìƒ‰ |

**ê²€ìƒ‰ ì„¤ì •**:
```json
{
  "retrieval_model": {
    "search_method": "semantic_search",
    "reranking_enable": true,
    "top_k": 3,
    "score_threshold_enabled": true,
    "score_threshold": 0.5
  }
}
```

#### 2. OpenAI API ì—°ë™

**ëª¨ë¸**: gpt-4o-mini
**ì˜¨ë„**: 0.7
**ìµœëŒ€ í† í°**: 1000

**ì‚¬ìš© ëª©ì **:
- FAQ + ë²•ë ¹ ë¬¸ì„œ ê¸°ë°˜ ë‹µë³€ ìƒì„±
- ì œì•ˆ ë‹µë³€ì„œ ìƒì„± (ê³µì‹ ì–‘ì‹)

#### 3. ë¡œì»¬ ë°ì´í„° (faq_topic.xlsx)

**ì—­í• **: policy_anchor ë§¤í•‘ í…Œì´ë¸”

**êµ¬ì¡°**:
```
faq_id | question | answer_text | policy_anchor | tag
-------|----------|-------------|---------------|----
FAQ-í˜‘ì•½ì²´ê²°-0002 | ì‚¬ì—…ë¹„ êµë¶€... | ... | ì§€ì¹¨ ì œ13ì¡°; ë³„ì§€ ì œ2í˜¸ | í˜‘ì•½ì²´ê²°,ì‚¬ì—…ë¹„ êµë¶€
```

**ì‚¬ìš© ë°©ë²•**:
```python
# ì„œë²„ ì‹œì‘ ì‹œ ë¡œë“œ
faq_df = pd.read_excel('data/faq_topic.xlsx')
faq_policy_map = dict(zip(faq_df['faq_id'], faq_df['policy_anchor']))

# ë§¤í•‘
policy_anchor = faq_policy_map.get(faq_id)  # "ì§€ì¹¨ ì œ13ì¡°; ë³„ì§€ ì œ2í˜¸"
```

---

### í™˜ê²½ ì„¤ì •

#### í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (`fund/.env`)

```bash
# OpenAI API
OPENAI_API_KEY=sk-...

# Dify Knowledge Configuration
DIFY_API_URL=http://112.173.179.199:5001/v1
DIFY_API_KEY=dataset-Q0C0AIJh8le8WMK8SpU1Bkh2
DIFY_DATASET_ID=68f0788b-4623-4ecc-bd4f-20199b4517a4

# AI Response Mode
AI_MODE=dify
FALLBACK_TO_OPENAI=True

# Server
HOST=0.0.0.0
PORT=5000
DEBUG=False

# Logging
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
```

---

### ì‹¤í–‰ ë°©ë²•

#### ë°±ì—”ë“œ ì‹¤í–‰
```bash
cd fund
python app.py
```

#### í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰
```bash
npm start
# â†’ http://localhost:3000
```

---

### ê°œë°œ ìƒíƒœ

#### âœ… ì™„ë£Œëœ ê¸°ëŠ¥
- React ê¸°ë°˜ ChatGPT ìŠ¤íƒ€ì¼ UI
- Flask ë°±ì—”ë“œ ì„œë²„ êµ¬ì¶•
- Dify Knowledge RAG ì—°ë™
- í•˜ì´ë¸Œë¦¬ë“œ FAQ ë§¤ì¹­ ì‹œìŠ¤í…œ ì„¤ê³„
- FAQ Markdown ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸
- ë¡œê¹… ì‹œìŠ¤í…œ
- Supabase ìŠ¤í‚¤ë§ˆ ì •ì˜

#### ğŸš§ ì§„í–‰ ì˜ˆì •
- [ ] FAQë¥¼ Difyì— ì—…ë¡œë“œ
- [ ] í•˜ì´ë¸Œë¦¬ë“œ ë§¤ì¹­ ë¡œì§ êµ¬í˜„
- [ ] policy_anchor ë§¤í•‘ ì‹œìŠ¤í…œ êµ¬í˜„
- [ ] ë²•ë ¹ ë¬¸ì„œ Dify ì—…ë¡œë“œ
- [ ] í†µí•© í…ŒìŠ¤íŠ¸

---
---

## [3ë‹¨ê³„] ì‹ ì…ê°œë°œììš© ë°ì´í„° íë¦„

### í•˜ì´ë¸Œë¦¬ë“œ RAG ë°©ì‹ ì „ì²´ í”Œë¡œìš°

```
ì‚¬ìš©ì: "ì‚¬ì—…ë¹„ êµë¶€ëŠ” ì–´ë–»ê²Œ ë°›ë‚˜ìš”?"
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Flask /api/chat ì—”ë“œí¬ì¸íŠ¸                   â”‚
â”‚ - ì‚¬ìš©ì ë©”ì‹œì§€ ìˆ˜ì‹                                  â”‚
â”‚ - session_id í™•ì¸/ìƒì„±                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Dify Knowledge - FAQ ê²€ìƒ‰                    â”‚
â”‚                                                      â”‚
â”‚ call_dify_knowledge("ì‚¬ì—…ë¹„ êµë¶€ëŠ” ì–´ë–»ê²Œ ë°›ë‚˜ìš”?")   â”‚
â”‚                                                      â”‚
â”‚ Dify Response:                                       â”‚
â”‚ {                                                    â”‚
â”‚   "records": [                                       â”‚
â”‚     {                                                â”‚
â”‚       "segment": {                                   â”‚
â”‚         "content": "---\nfaq_id: FAQ-í˜‘ì•½ì²´ê²°-0002   â”‚
â”‚                     \n# ì‚¬ì—…ë¹„ êµë¶€ ì‹ ì²­ ë° ì ˆì°¨ëŠ”?  â”‚
â”‚                     \n## ë‹µë³€\nì‚¬ì—…ë¹„ëŠ”..."          â”‚
â”‚       },                                             â”‚
â”‚       "score": 0.89                                  â”‚
â”‚     }                                                â”‚
â”‚   ]                                                  â”‚
â”‚ }                                                    â”‚
â”‚                                                      â”‚
â”‚ âœ… FAQ ë‚´ìš© í™•ë³´: "ì‚¬ì—…ë¹„ëŠ” ìê¸ˆë°°ì •ì‹ ì²­ì„œë¥¼..."      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: faq_id ì¶”ì¶œ                                  â”‚
â”‚                                                      â”‚
â”‚ extract_faq_id_from_content(record)                  â”‚
â”‚                                                      â”‚
â”‚ ì¶”ì¶œ ë°©ë²•:                                           â”‚
â”‚ 1. Metadataì—ì„œ íŒŒì‹± (YAML frontmatter)              â”‚
â”‚ 2. ì •ê·œì‹ìœ¼ë¡œ "faq_id: ..." ì°¾ê¸°                     â”‚
â”‚ 3. ë¬¸ì„œëª…ì—ì„œ ì¶”ì¶œ                                   â”‚
â”‚                                                      â”‚
â”‚ ê²°ê³¼: faq_id = "FAQ-í˜‘ì•½ì²´ê²°-0002"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: ë¡œì»¬ ë§¤í•‘ (policy_anchor ê°€ì ¸ì˜¤ê¸°)           â”‚
â”‚                                                      â”‚
â”‚ faq_policy_map = {                                   â”‚
â”‚   "FAQ-í˜‘ì•½ì²´ê²°-0002": "ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„  â”‚
â”‚                         ê´€ë¦¬ ë“±ì— ê´€í•œ ì§€ì¹¨ ì œ13ì¡°;  â”‚
â”‚                         ë³„ì§€ ì œ2í˜¸ ì„œì‹"             â”‚
â”‚ }                                                    â”‚
â”‚                                                      â”‚
â”‚ policy_anchor = faq_policy_map["FAQ-í˜‘ì•½ì²´ê²°-0002"]  â”‚
â”‚                                                      â”‚
â”‚ âœ… ê²°ê³¼: "ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„ ê´€ë¦¬ ë“±ì—       â”‚
â”‚          ê´€í•œ ì§€ì¹¨ ì œ13ì¡°; ë³„ì§€ ì œ2í˜¸ ì„œì‹"          â”‚
â”‚                                                      â”‚
â”‚ âš ï¸ ì¤‘ìš”: ì´ ê°’ì„ ê·¸ëŒ€ë¡œ related_lawsë¡œ ì‚¬ìš©!         â”‚
â”‚          (LLM ìƒì„± X, ë°ì´í„°ì—ì„œ ì§ì ‘ ê°€ì ¸ì˜´)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Dify Knowledge - ë²•ë ¹ ë¬¸ì„œ ê²€ìƒ‰              â”‚
â”‚                                                      â”‚
â”‚ policy_anchors = [                                   â”‚
â”‚   "ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„ ê´€ë¦¬ ë“±ì— ê´€í•œ ì§€ì¹¨    â”‚
â”‚    ì œ13ì¡°",                                          â”‚
â”‚   "ë³„ì§€ ì œ2í˜¸ ì„œì‹"                                   â”‚
â”‚ ]                                                    â”‚
â”‚                                                      â”‚
â”‚ for anchor in policy_anchors:                        â”‚
â”‚   dify_result = call_dify_knowledge(anchor, top_k=2) â”‚
â”‚                                                      â”‚
â”‚ Dify Response:                                       â”‚
â”‚ {                                                    â”‚
â”‚   "records": [                                       â”‚
â”‚     {                                                â”‚
â”‚       "segment": {                                   â”‚
â”‚         "content": "ì œ13ì¡° (ì‚¬ì—…ë¹„ì˜ êµë¶€)            â”‚
â”‚                     â‘  ì£¼ê´€ê¸°ê´€ì€ í˜‘ì•½ì²´ê²° í›„..."     â”‚
â”‚       }                                              â”‚
â”‚     }                                                â”‚
â”‚   ]                                                  â”‚
â”‚ }                                                    â”‚
â”‚                                                      â”‚
â”‚ âœ… ë²•ë ¹ ë¬¸ì„œ ë‚´ìš© í™•ë³´                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: LLM ë‹µë³€ ìƒì„±                                â”‚
â”‚                                                      â”‚
â”‚ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±:                                       â”‚
â”‚                                                      â”‚
â”‚ context = """                                        â”‚
â”‚ ì°¸ê³  FAQ:                                            â”‚
â”‚ Q: ì‚¬ì—…ë¹„ êµë¶€ ì‹ ì²­ ë° ì ˆì°¨ëŠ”?                        â”‚
â”‚ A: ì‚¬ì—…ë¹„ëŠ” ìê¸ˆë°°ì •ì‹ ì²­ì„œë¥¼ ì œì¶œí•˜ì—¬...              â”‚
â”‚                                                      â”‚
â”‚ ì°¸ê³  ë²•ë ¹:                                           â”‚
â”‚ ì œ13ì¡° (ì‚¬ì—…ë¹„ì˜ êµë¶€)                                â”‚
â”‚ â‘  ì£¼ê´€ê¸°ê´€ì€ í˜‘ì•½ì²´ê²° í›„ ìê¸ˆë°°ì •ì‹ ì²­ì„œë¥¼...          â”‚
â”‚ """                                                  â”‚
â”‚                                                      â”‚
â”‚ OpenAI API í˜¸ì¶œ:                                     â”‚
â”‚ response = client.chat.completions.create(           â”‚
â”‚   model="gpt-4o-mini",                               â”‚
â”‚   messages=[                                         â”‚
â”‚     {"role": "system", "content": context},          â”‚
â”‚     {"role": "user", "content": "ì‚¬ì—…ë¹„ êµë¶€ëŠ”..."}  â”‚
â”‚   ]                                                  â”‚
â”‚ )                                                    â”‚
â”‚                                                      â”‚
â”‚ âœ… ìƒì„±ëœ ë‹µë³€:                                       â”‚
â”‚ "ì‚¬ì—…ë¹„ êµë¶€ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰ë©ë‹ˆë‹¤.                â”‚
â”‚  ë¨¼ì € í˜‘ì•½ ì²´ê²° í›„ ìê¸ˆë°°ì •ì‹ ì²­ì„œë¥¼ ì œì¶œí•˜ê³ ..."      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: ì œì•ˆ ë‹µë³€ ìƒì„± (ì„ íƒ)                         â”‚
â”‚                                                      â”‚
â”‚ generate_suggested_answer(user_message, answer)      â”‚
â”‚                                                      â”‚
â”‚ â†’ ê³µì‹ ë¯¼ì› ë‹µë³€ì„œ ì–‘ì‹ ìƒì„±                          â”‚
â”‚   "ë¯¼ì›ì¸ë‹˜ê»˜, ê·€í•˜ì˜ ë¬¸ì˜ì—..."                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: ì‘ë‹µ êµ¬ì„± ë° ì „ì†¡                             â”‚
â”‚                                                      â”‚
â”‚ response = {                                         â”‚
â”‚   "success": true,                                   â”‚
â”‚   "message": "ì‚¬ì—…ë¹„ êµë¶€ëŠ” ë‹¤ìŒê³¼ ê°™ì´...",          â”‚
â”‚   "suggested_answer": "ë¯¼ì›ì¸ë‹˜ê»˜...",               â”‚
â”‚   "related_laws": [                                  â”‚
â”‚     {                                                â”‚
â”‚       "title": "ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„ ê´€ë¦¬ ë“±ì—  â”‚
â”‚                ê´€í•œ ì§€ì¹¨ ì œ13ì¡°",                     â”‚
â”‚       "source": "FAQ Database",                      â”‚
â”‚       "faq_id": "FAQ-í˜‘ì•½ì²´ê²°-0002"                  â”‚
â”‚     },                                               â”‚
â”‚     {                                                â”‚
â”‚       "title": "ë³„ì§€ ì œ2í˜¸ ì„œì‹",                     â”‚
â”‚       "source": "FAQ Database",                      â”‚
â”‚       "faq_id": "FAQ-í˜‘ì•½ì²´ê²°-0002"                  â”‚
â”‚     }                                                â”‚
â”‚   ],                                                 â”‚
â”‚   â†‘ ë¡œì»¬ ë§¤í•‘ì—ì„œ ê°€ì ¸ì˜¨ ê°’ ê·¸ëŒ€ë¡œ!                   â”‚
â”‚   (LLMì´ ìƒì„±í•˜ì§€ ì•ŠìŒ)                               â”‚
â”‚                                                      â”‚
â”‚   "session_id": "abc-123",                           â”‚
â”‚   "metadata": {                                      â”‚
â”‚     "matched_faq_id": "FAQ-í˜‘ì•½ì²´ê²°-0002",           â”‚
â”‚     "ai_mode": "dify"                                â”‚
â”‚   }                                                  â”‚
â”‚ }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 9: í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ                               â”‚
â”‚                                                      â”‚
â”‚ - ë‹µë³€: "ì‚¬ì—…ë¹„ êµë¶€ëŠ” ë‹¤ìŒê³¼ ê°™ì´..."               â”‚
â”‚ - ê´€ë ¨ ë²•ë ¹:                                         â”‚
â”‚   â€¢ ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„ ê´€ë¦¬ ë“±ì— ê´€í•œ ì§€ì¹¨   â”‚
â”‚     ì œ13ì¡°                                           â”‚
â”‚   â€¢ ë³„ì§€ ì œ2í˜¸ ì„œì‹                                   â”‚
â”‚                                                      â”‚
â”‚ ì‚¬ìš©ìê°€ í™•ì¸                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### í•µì‹¬ í¬ì¸íŠ¸ ì •ë¦¬

#### 1. **Difyì˜ ì—­í• **
```
âœ… FAQ ê²€ìƒ‰ (Semantic Search)
   - ì‚¬ìš©ì ì§ˆë¬¸ â†’ ê´€ë ¨ FAQ ì°¾ê¸°
   - ê²€ìƒ‰ ì •í™•ë„: 80-90%

âœ… FAQ ë‹µë³€ ë‚´ìš© ì œê³µ
   - LLMì—ê²Œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „ë‹¬

âœ… ë²•ë ¹ ë¬¸ì„œ ê²€ìƒ‰
   - policy_anchor í‚¤ì›Œë“œ â†’ ë²•ë ¹ ë¬¸ì„œ ì°¾ê¸°

âœ… ë²•ë ¹ ë‚´ìš© ì œê³µ
   - LLMì—ê²Œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „ë‹¬
```

#### 2. **ë¡œì»¬ faq_topic.xlsxì˜ ì—­í• **
```
âœ… policy_anchor ë§¤í•‘ (ì •í™•ë„ 100%)
   - faq_id â†’ policy_anchor
   - "FAQ-í˜‘ì•½ì²´ê²°-0002" â†’ "ì§€ì¹¨ ì œ13ì¡°; ë³„ì§€ ì œ2í˜¸"

âœ… ì´ ê°’ì„ ê·¸ëŒ€ë¡œ related_lawsë¡œ ì‚¬ìš©
   - LLMì´ ìƒì„±í•˜ì§€ ì•ŠìŒ
   - ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥
```

#### 3. **LLM(OpenAI)ì˜ ì—­í• **
```
âœ… ë‹µë³€ ìƒì„±
   - Difyì—ì„œ ë°›ì€ FAQ ë‹µë³€ ì°¸ê³ 
   - Difyì—ì„œ ë°›ì€ ë²•ë ¹ ë‚´ìš© ì°¸ê³ 
   - ìµœì¢… ë‹µë³€ ìƒì„±

âœ… ì œì•ˆ ë‹µë³€ì„œ ìƒì„±
   - ê³µì‹ ì–‘ì‹ ì‘ì„±

âŒ ê´€ë ¨ë²•ë ¹ì€ ìƒì„±í•˜ì§€ ì•ŠìŒ
   - ë¡œì»¬ ë§¤í•‘ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

---

### ì—ëŸ¬ ì²˜ë¦¬

#### 1. FAQ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ
```python
if not dify_result['success'] or not dify_result['records']:
    app.logger.warning("No FAQ matched")

    if FALLBACK_TO_OPENAI:
        # OpenAI ì§ì ‘ í˜¸ì¶œ (Dify ì—†ì´)
        answer = generate_openai_response(user_message)
    else:
        return jsonify({'error': 'FAQ ë§¤ì¹­ ì‹¤íŒ¨'})
```

#### 2. faq_id ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ
```python
faq_id = extract_faq_id_from_content(record)

if not faq_id:
    app.logger.warning("faq_id extraction failed")
    # FAQ ë‚´ìš©ë§Œìœ¼ë¡œ ë‹µë³€ ìƒì„± (policy_anchor ì—†ì´)
```

#### 3. policy_anchor ë§¤í•‘ ì‹¤íŒ¨ ì‹œ
```python
policy_anchor = faq_policy_map.get(faq_id)

if not policy_anchor:
    app.logger.error(f"No policy_anchor for {faq_id}")
    # FAQ ë‹µë³€ë§Œìœ¼ë¡œ ìƒì„±
    # related_lawsëŠ” ë¹ˆ ë°°ì—´
```

---

### ë¡œê¹…

#### app.log
```
[2025-10-21 15:30:00] [INFO] Chat request: ì‚¬ì—…ë¹„ êµë¶€ëŠ”?
[2025-10-21 15:30:01] [INFO] Dify FAQ search completed - Retrieved 3 FAQs
[2025-10-21 15:30:01] [INFO] Extracted faq_id: FAQ-í˜‘ì•½ì²´ê²°-0002
[2025-10-21 15:30:01] [INFO] Mapped policy_anchor: ì§€ì¹¨ ì œ13ì¡°; ë³„ì§€ ì œ2í˜¸
[2025-10-21 15:30:02] [INFO] Dify policy search completed - Retrieved 4 docs
[2025-10-21 15:30:04] [INFO] Answer generated successfully
```

#### api_calls.log
```
[2025-10-21 15:30:01] Dify FAQ search: Query="ì‚¬ì—…ë¹„ êµë¶€ëŠ”?" Results=3 Time=0.8s
[2025-10-21 15:30:02] Dify Policy search: Query="ì§€ì¹¨ ì œ13ì¡°" Results=2 Time=0.6s
[2025-10-21 15:30:04] OpenAI answer generation: Tokens=456 Time=1.8s
```

---

### ì£¼ìš” ë°ì´í„° íƒ€ì…

#### TypeScript ì¸í„°í˜ì´ìŠ¤ (í”„ë¡ íŠ¸ì—”ë“œ)

```typescript
// src/types/index.ts

export interface Message {
  id: string;
  text: string;
  sender: 'user' | 'bot';
  timestamp: Date;
}

export interface RelatedLaw {
  title: string;          // "ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²°... ì œ13ì¡°"
  source: string;         // "FAQ Database"
  faq_id?: string;        // "FAQ-í˜‘ì•½ì²´ê²°-0002"
  content?: string;       // ì„ íƒì  ë‚´ìš©
}

export interface ChatResponse {
  success: boolean;
  message: string;                    // LLM ìƒì„± ë‹µë³€
  suggested_answer?: string;          // ì œì•ˆ ë‹µë³€ì„œ
  related_laws: RelatedLaw[];         // ë¡œì»¬ ë§¤í•‘ê°’ ê·¸ëŒ€ë¡œ
  session_id: string;
  metadata?: {
    matched_faq_id?: string;
    ai_mode: 'dify' | 'openai';
  };
}
```

---
---

## [ë‹¤ìŒ ì§„í–‰ ë‹¨ê³„] êµ¬í˜„ ë¡œë“œë§µ

### ğŸ“‹ Phase 1: FAQ Dify ì—…ë¡œë“œ ì¤€ë¹„ (30ë¶„)

#### Step 1-1: FAQ Markdown ë³€í™˜
```bash
cd C:\cursor_work\test_dify
python scripts/convert_faq_for_dify.py
# ì„ íƒ: 1 (ê°œë³„ Markdown íŒŒì¼ - ì¶”ì²œ)
```

**ê²°ê³¼ í™•ì¸**:
- `data/faq_markdown/` í´ë”ì— 102ê°œ `.md` íŒŒì¼ ìƒì„±
- ê° íŒŒì¼ì— metadata í¬í•¨ í™•ì¸

**ì˜ˆì‹œ íŒŒì¼ (`FAQ-í˜‘ì•½ì²´ê²°-0002.md`)**:
```markdown
---
faq_id: FAQ-í˜‘ì•½ì²´ê²°-0002
tags: í˜‘ì•½ì²´ê²°,ì‚¬ì—…ë¹„ êµë¶€,ìê¸ˆë°°ì •ì‹ ì²­ì„œ,ìê¸ˆë°°ì •
policy_anchor: ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„ ê´€ë¦¬ ë“±ì— ê´€í•œ ì§€ì¹¨ ì œ13ì¡°; ë³„ì§€ ì œ2í˜¸ ì„œì‹
---

# ì‚¬ì—…ë¹„ êµë¶€ ì‹ ì²­ ë° ì ˆì°¨ëŠ”?

## ë‹µë³€

ì‚¬ì—…ë¹„ëŠ” ìê¸ˆë°°ì •ì‹ ì²­ì„œë¥¼ ì œì¶œí•˜ì—¬ êµë¶€ë°›ìŠµë‹ˆë‹¤...

## ê´€ë ¨ ë²•ë ¹

ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„ ê´€ë¦¬ ë“±ì— ê´€í•œ ì§€ì¹¨ ì œ13ì¡°; ë³„ì§€ ì œ2í˜¸ ì„œì‹

## íƒœê·¸

í˜‘ì•½ì²´ê²°,ì‚¬ì—…ë¹„ êµë¶€,ìê¸ˆë°°ì •ì‹ ì²­ì„œ,ìê¸ˆë°°ì •
```

#### Step 1-2: Difyì— FAQ ì—…ë¡œë“œ

1. Dify ì›¹ ì¸í„°í˜ì´ìŠ¤ ì ‘ì†
   ```
   http://112.173.179.199:5001
   ```

2. **Knowledge** ì„¹ì…˜ìœ¼ë¡œ ì´ë™

3. **ê¸°ì¡´ Dataset ì„ íƒ** ë˜ëŠ” **ìƒˆ Dataset ìƒì„±**
   - ì´ë¦„: "ICT ê¸°ê¸ˆì‚¬ì—… FAQ"

4. **Add Document** í´ë¦­

5. **í´ë” ì „ì²´ ì—…ë¡œë“œ**
   - `data/faq_markdown/` í´ë” ì„ íƒ
   - 102ê°œ íŒŒì¼ ëª¨ë‘ ì„ íƒ

6. **Chunking ì„¤ì •**:
   ```
   Chunk Strategy: Custom
   Chunk Size: 1000 (FAQ í•˜ë‚˜ê°€ í•˜ë‚˜ì˜ chunk)
   Overlap: 0 (FAQëŠ” ë…ë¦½ì )
   Separator: \n---\n (ê° FAQ êµ¬ë¶„)
   ```

7. **Embedding ì„¤ì •**:
   ```
   Embedding Model: text-embedding-3-small (ë˜ëŠ” ê¸°ë³¸ê°’)
   ```

8. **Save and Process** í´ë¦­

9. **ì²˜ë¦¬ ì™„ë£Œ ëŒ€ê¸°** (ì•½ 2-3ë¶„)

10. **ìƒˆ Dataset ID ë³µì‚¬**
    ```
    ì˜ˆ: faq-12345678-1234-1234-1234-123456789abc
    ```

#### Step 1-3: .env íŒŒì¼ ì—…ë°ì´íŠ¸
```bash
# fund/.env

# ê¸°ì¡´ Dataset IDë¥¼ FAQ Dataset IDë¡œ êµì²´
DIFY_DATASET_ID_FAQ=faq-12345678-1234-1234-1234-123456789abc

# Policy ë¬¸ì„œìš© Dataset ID (ê¸°ì¡´ ìœ ì§€ ë˜ëŠ” ë³„ë„ ìƒì„±)
DIFY_DATASET_ID_POLICY=68f0788b-4623-4ecc-bd4f-20199b4517a4
```

---

### ğŸ“‹ Phase 2: ë°±ì—”ë“œ í•˜ì´ë¸Œë¦¬ë“œ ë¡œì§ êµ¬í˜„ (2-3ì‹œê°„)

#### Step 2-1: faq_id ì¶”ì¶œ í•¨ìˆ˜ ì¶”ê°€

**íŒŒì¼**: `fund/app.py`

```python
import re
import yaml

def extract_faq_id_from_content(record):
    """
    Dify ê²€ìƒ‰ ê²°ê³¼ì—ì„œ faq_id ì¶”ì¶œ

    Args:
        record: Dify API ì‘ë‹µì˜ records[0]

    Returns:
        str: faq_id (ì˜ˆ: "FAQ-í˜‘ì•½ì²´ê²°-0002") or None
    """
    try:
        content = record.get('segment', {}).get('content', '')

        # ë°©ë²• 1: YAML frontmatter íŒŒì‹±
        if content.startswith('---'):
            parts = content.split('---', 2)
            if len(parts) >= 2:
                try:
                    metadata = yaml.safe_load(parts[1])
                    faq_id = metadata.get('faq_id')
                    if faq_id:
                        app.logger.debug(f"Extracted faq_id from metadata: {faq_id}")
                        return faq_id
                except yaml.YAMLError as e:
                    app.logger.warning(f"YAML parsing failed: {e}")

        # ë°©ë²• 2: ì •ê·œì‹ìœ¼ë¡œ ì¶”ì¶œ
        match = re.search(r'faq_id:\s*(.+)', content)
        if match:
            faq_id = match.group(1).strip()
            app.logger.debug(f"Extracted faq_id from regex: {faq_id}")
            return faq_id

        # ë°©ë²• 3: ë¬¸ì„œëª…ì—ì„œ ì¶”ì¶œ
        doc_name = record.get('segment', {}).get('document', {}).get('name', '')
        if doc_name.endswith('.md'):
            faq_id = doc_name[:-3]
            app.logger.debug(f"Extracted faq_id from filename: {faq_id}")
            return faq_id

        app.logger.warning("faq_id extraction failed")
        return None

    except Exception as e:
        app.logger.error(f"Error extracting faq_id: {e}")
        return None
```

#### Step 2-2: ë¡œì»¬ ë§¤í•‘ í…Œì´ë¸” ë¡œë“œ

**íŒŒì¼**: `fund/app.py`

```python
import pandas as pd

# ì„œë²„ ì‹œì‘ ì‹œ FAQ ë§¤í•‘ í…Œì´ë¸” ë¡œë“œ
try:
    faq_df = pd.read_excel('data/faq_topic.xlsx')
    faq_policy_map = dict(zip(faq_df['faq_id'], faq_df['policy_anchor']))
    app.logger.info(f"Loaded {len(faq_policy_map)} FAQ policy mappings")
except Exception as e:
    app.logger.error(f"Failed to load FAQ mapping: {e}")
    faq_policy_map = {}
```

#### Step 2-3: /api/chat ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •

**íŒŒì¼**: `fund/app.py`

```python
@app.route('/api/chat', methods=['POST'])
def chat():
    """Handle chat messages with hybrid FAQ RAG"""
    session_id = None
    try:
        data = request.get_json()
        user_message = data.get('message', '')
        session_id = data.get('session_id', str(uuid.uuid4()))

        app.logger.info(f'Chat request from session {session_id}: {user_message[:100]}...')

        # Initialize session
        if session_id not in chat_sessions:
            chat_sessions[session_id] = {
                'messages': [],
                'created_at': datetime.now()
            }

        # Add user message to session
        chat_sessions[session_id]['messages'].append({
            'role': 'user',
            'content': user_message
        })

        # ===== STEP 1: Dify FAQ ê²€ìƒ‰ =====
        app.logger.info('Step 1: Searching FAQ in Dify')
        faq_result = call_dify_knowledge(user_message, top_k=3)

        if not faq_result['success'] or not faq_result['records']:
            app.logger.warning('FAQ search failed, using fallback')
            # Fallback to OpenAI
            assistant_message = generate_openai_response(session_id, user_message)
            related_laws = []
            matched_faq_id = None
        else:
            # ===== STEP 2: faq_id ì¶”ì¶œ =====
            app.logger.info('Step 2: Extracting faq_id')
            best_faq_record = faq_result['records'][0]
            faq_id = extract_faq_id_from_content(best_faq_record)

            if not faq_id:
                app.logger.warning('faq_id extraction failed')
                # FAQ ë‚´ìš©ë§Œìœ¼ë¡œ ë‹µë³€
                assistant_message = generate_answer_with_dify_rag(
                    user_message,
                    faq_result['records'],
                    None
                )
                related_laws = []
                matched_faq_id = None
            else:
                # ===== STEP 3: ë¡œì»¬ ë§¤í•‘ (policy_anchor) =====
                app.logger.info(f'Step 3: Mapping policy_anchor for {faq_id}')
                policy_anchor = faq_policy_map.get(faq_id, '')

                if not policy_anchor:
                    app.logger.error(f'No policy_anchor for {faq_id}')
                    # FAQë§Œìœ¼ë¡œ ë‹µë³€
                    assistant_message = generate_answer_with_dify_rag(
                        user_message,
                        faq_result['records'],
                        None
                    )
                    related_laws = []
                    matched_faq_id = faq_id
                else:
                    app.logger.info(f'Mapped policy_anchor: {policy_anchor}')

                    # ===== STEP 4: policy_anchorë¡œ ë²•ë ¹ ë¬¸ì„œ ê²€ìƒ‰ =====
                    app.logger.info('Step 4: Searching policy documents')
                    policy_docs = []
                    policy_anchors = [p.strip() for p in policy_anchor.split(';')]

                    for anchor in policy_anchors[:2]:  # ìµœëŒ€ 2ê°œë§Œ
                        policy_result = call_dify_knowledge(anchor, top_k=2)
                        if policy_result['success']:
                            policy_docs.extend(policy_result['records'])

                    # ===== STEP 5: LLM ë‹µë³€ ìƒì„± =====
                    app.logger.info('Step 5: Generating answer with context')
                    assistant_message = generate_answer_with_context(
                        user_message,
                        faq_result['records'],
                        policy_docs
                    )

                    # ===== STEP 6: policy_anchorë¥¼ ê·¸ëŒ€ë¡œ related_lawsë¡œ =====
                    related_laws = []
                    for anchor in policy_anchors:
                        related_laws.append({
                            'title': anchor,
                            'source': 'FAQ Database',
                            'faq_id': faq_id
                        })

                    matched_faq_id = faq_id

        # Add assistant message to session
        chat_sessions[session_id]['messages'].append({
            'role': 'assistant',
            'content': assistant_message
        })

        # Generate suggested answer
        suggested_answer = generate_suggested_answer(user_message, assistant_message)

        # Response
        return jsonify({
            'success': True,
            'message': assistant_message,
            'suggested_answer': suggested_answer,
            'related_laws': related_laws,
            'session_id': session_id,
            'metadata': {
                'matched_faq_id': matched_faq_id,
                'ai_mode': AI_MODE
            }
        })

    except Exception as e:
        error_session = session_id if session_id else 'unknown'
        app.logger.error(f'Error in chat endpoint: {str(e)}')
        app.logger.error(f'Traceback: {traceback.format_exc()}')
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500
```

#### Step 2-4: ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë‹µë³€ ìƒì„± í•¨ìˆ˜

**íŒŒì¼**: `fund/app.py`

```python
def generate_answer_with_context(user_message, faq_records, policy_docs):
    """
    FAQ + Policy ë¬¸ì„œ ì»¨í…ìŠ¤íŠ¸ë¡œ ë‹µë³€ ìƒì„±

    Args:
        user_message: ì‚¬ìš©ì ì§ˆë¬¸
        faq_records: Difyì—ì„œ ê²€ìƒ‰í•œ FAQ ë ˆì½”ë“œ
        policy_docs: Difyì—ì„œ ê²€ìƒ‰í•œ ë²•ë ¹ ë¬¸ì„œ ë ˆì½”ë“œ

    Returns:
        str: ìƒì„±ëœ ë‹µë³€
    """
    try:
        # FAQ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
        faq_context = ""
        for idx, record in enumerate(faq_records[:2]):  # ìƒìœ„ 2ê°œë§Œ
            content = record.get('segment', {}).get('content', '')
            faq_context += f"\n[ì°¸ê³  FAQ {idx+1}]\n{content}\n"

        # Policy ë¬¸ì„œ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
        policy_context = ""
        if policy_docs:
            for idx, doc in enumerate(policy_docs[:3]):  # ìƒìœ„ 3ê°œë§Œ
                content = doc.get('segment', {}).get('content', '')
                policy_context += f"\n[ì°¸ê³  ë²•ë ¹ {idx+1}]\n{content}\n"

        # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
        system_prompt = f"""ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ê¸°ê¸ˆ ë¯¼ì›ì²˜ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ë‹¤ìŒ ìë£Œë¥¼ ì°¸ê³ í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”:

{faq_context}

{policy_context}

ë‹µë³€ ì‹œ ì§€ì¹¨:
1. ìœ„ ì°¸ê³  ìë£Œì˜ ë‚´ìš©ì„ ì •í™•íˆ í™œìš©í•˜ì„¸ìš”
2. ë²•ë ¹ì´ë‚˜ ê·œì •ì„ ì¸ìš©í•  ë•ŒëŠ” ì •í™•í•œ ì¡°í•­ì„ ëª…ì‹œí•˜ì„¸ìš”
3. í•„ìš”í•œ ì„œë¥˜ë‚˜ ì ˆì°¨ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì•ˆë‚´í•˜ì„¸ìš”
4. ì°¸ê³  ìë£Œì— ì—†ëŠ” ë‚´ìš©ì€ ì¶”ì¸¡í•˜ì§€ ë§ê³ , ì¶”ê°€ í™•ì¸ì´ í•„ìš”í•˜ë‹¤ê³  ì•ˆë‚´í•˜ì„¸ìš”
5. ì •ì¤‘í•˜ê³  ê³µì†í•œ ì–´íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”"""

        # OpenAI í˜¸ì¶œ
        start_time = datetime.now()
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {'role': 'system', 'content': system_prompt},
                {'role': 'user', 'content': user_message}
            ],
            temperature=0.7,
            max_tokens=1000
        )

        elapsed_time = (datetime.now() - start_time).total_seconds()
        assistant_message = response.choices[0].message.content

        api_logger.info(f'Answer generated in {elapsed_time:.2f}s - Tokens: {response.usage.total_tokens}')

        return assistant_message

    except Exception as e:
        app.logger.error(f'Error generating answer: {str(e)}')
        raise
```

#### Step 2-5: requirements ì¶”ê°€

**íŒŒì¼**: `fund/pyproject.toml`

```toml
[project]
dependencies = [
    "flask>=3.1.2",
    "openai>=1.106.1",
    "python-dotenv>=1.1.1",
    "requests>=2.32.5",
    "pandas>=2.0.0",      # ì¶”ê°€
    "openpyxl>=3.1.0",    # ì¶”ê°€ (Excel ì½ê¸°)
    "pyyaml>=6.0"         # ì¶”ê°€ (YAML íŒŒì‹±)
]
```

**ì„¤ì¹˜**:
```bash
cd fund
uv sync
```

---

### ğŸ“‹ Phase 3: í…ŒìŠ¤íŠ¸ (30ë¶„)

#### Step 3-1: ì„œë²„ ì‹œì‘
```bash
cd fund
python app.py
```

**ë¡œê·¸ í™•ì¸**:
```
[INFO] Loaded 102 FAQ policy mappings
[INFO] AI Mode: dify
[INFO] Starting Civil Complaint Chatbot Application
```

#### Step 3-2: API í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ 1: FAQ ë§¤ì¹­ í™•ì¸**
```bash
curl -X POST http://localhost:5000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ì‚¬ì—…ë¹„ êµë¶€ ì ˆì°¨ê°€ ê¶ê¸ˆí•©ë‹ˆë‹¤"}'
```

**ì˜ˆìƒ ì‘ë‹µ**:
```json
{
  "success": true,
  "message": "ì‚¬ì—…ë¹„ êµë¶€ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰ë©ë‹ˆë‹¤...",
  "related_laws": [
    {
      "title": "ê¸°ê¸ˆì‚¬ì—… í˜‘ì•½ì²´ê²° ë° ì‚¬ì—…ë¹„ ê´€ë¦¬ ë“±ì— ê´€í•œ ì§€ì¹¨ ì œ13ì¡°",
      "source": "FAQ Database",
      "faq_id": "FAQ-í˜‘ì•½ì²´ê²°-0002"
    }
  ],
  "metadata": {
    "matched_faq_id": "FAQ-í˜‘ì•½ì²´ê²°-0002"
  }
}
```

**í…ŒìŠ¤íŠ¸ 2: ë‹¤ì–‘í•œ ì§ˆë¬¸**
```bash
# ì¸ê±´ë¹„ ê´€ë ¨
curl -X POST http://localhost:5000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ì¸ê±´ë¹„ ë³´ìˆ˜ì™€ ìƒìš©ì„ê¸ˆ ì°¨ì´ëŠ”?"}'

# í˜‘ì•½ ê´€ë ¨
curl -X POST http://localhost:5000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ì‚¬ì—…ìˆ˜í–‰ê³„íšì„œì— ë­ í¬í•¨í•´ì•¼ í•˜ë‚˜ìš”?"}'
```

#### Step 3-3: ë¡œê·¸ í™•ì¸
```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
tail -f fund/logs/app.log

# API í˜¸ì¶œ ë¡œê·¸
tail -f fund/logs/api_calls.log
```

---

### ğŸ“‹ Phase 4: í”„ë¡ íŠ¸ì—”ë“œ í†µí•© í…ŒìŠ¤íŠ¸ (10ë¶„)

#### Step 4-1: í”„ë¡ íŠ¸ì—”ë“œ ì‹œì‘
```bash
npm start
```

#### Step 4-2: ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸

1. `http://localhost:3000` ì ‘ì†

2. ì±„íŒ…ì°½ì— ì§ˆë¬¸ ì…ë ¥:
   - "ì‚¬ì—…ë¹„ êµë¶€ëŠ” ì–´ë–»ê²Œ ë°›ë‚˜ìš”?"
   - "ì¸ê±´ë¹„ ê³„ì‚° ë°©ë²•ì´ ê¶ê¸ˆí•©ë‹ˆë‹¤"
   - "í˜‘ì•½ ì²´ê²° ì ˆì°¨ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”"

3. **í™•ì¸ ì‚¬í•­**:
   - âœ… ë‹µë³€ì´ FAQ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ëŠ”ì§€
   - âœ… ê´€ë ¨ ë²•ë ¹ì´ ì •í™•íˆ í‘œì‹œë˜ëŠ”ì§€
   - âœ… ë¡œë”© ìƒíƒœê°€ ì •ìƒì¸ì§€
   - âœ… ì—ëŸ¬ ì—†ì´ ë™ì‘í•˜ëŠ”ì§€

---

### ğŸ“‹ Phase 5: ìµœì í™” ë° ë§ˆë¬´ë¦¬ (ì„ íƒ)

#### Step 5-1: Chunking ìµœì í™”

Difyì—ì„œ FAQ ê²€ìƒ‰ ì •í™•ë„ í…ŒìŠ¤íŠ¸ í›„ ì¡°ì •:
```
Chunk Size: 800-1200 ì‚¬ì´ì—ì„œ ì¡°ì •
Overlap: 0-50 ì‚¬ì´ì—ì„œ ì¡°ì •
```

#### Step 5-2: ìºì‹± ì¶”ê°€ (ì„ íƒ)

ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ ìºì‹±:
```python
from functools import lru_cache

@lru_cache(maxsize=100)
def get_cached_faq_result(user_message):
    return call_dify_knowledge(user_message, top_k=3)
```

#### Step 5-3: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```python
# ê° ë‹¨ê³„ë³„ ì‹œê°„ ì¸¡ì • ì¶”ê°€
app.logger.info(f'FAQ search: {faq_time:.2f}s')
app.logger.info(f'Policy search: {policy_time:.2f}s')
app.logger.info(f'Answer generation: {answer_time:.2f}s')
app.logger.info(f'Total: {total_time:.2f}s')
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… FAQ Dify ì—…ë¡œë“œ
- [ ] FAQ Markdown ë³€í™˜ ì™„ë£Œ (102ê°œ íŒŒì¼)
- [ ] Difyì— ì—…ë¡œë“œ ì™„ë£Œ
- [ ] ìƒˆ Dataset ID ë³µì‚¬
- [ ] .env íŒŒì¼ ì—…ë°ì´íŠ¸

### âœ… ë°±ì—”ë“œ êµ¬í˜„
- [ ] `extract_faq_id_from_content()` í•¨ìˆ˜ ì¶”ê°€
- [ ] `faq_policy_map` ë¡œë“œ ì½”ë“œ ì¶”ê°€
- [ ] `/api/chat` ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •
- [ ] `generate_answer_with_context()` í•¨ìˆ˜ ì¶”ê°€
- [ ] `requirements.txt` ì—…ë°ì´íŠ¸ ë° ì„¤ì¹˜

### âœ… í…ŒìŠ¤íŠ¸
- [ ] ì„œë²„ ì‹œì‘ í™•ì¸
- [ ] API í…ŒìŠ¤íŠ¸ (curl)
- [ ] ë¡œê·¸ í™•ì¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ë‹¤ì–‘í•œ ì§ˆë¬¸ìœ¼ë¡œ ì •í™•ë„ í™•ì¸

---

## ì˜ˆìƒ ì†Œìš” ì‹œê°„

| Phase | ì‘ì—… | ì˜ˆìƒ ì‹œê°„ |
|-------|------|----------|
| Phase 1 | FAQ Dify ì—…ë¡œë“œ | 30ë¶„ |
| Phase 2 | ë°±ì—”ë“œ êµ¬í˜„ | 2-3ì‹œê°„ |
| Phase 3 | í…ŒìŠ¤íŠ¸ | 30ë¶„ |
| Phase 4 | í”„ë¡ íŠ¸ì—”ë“œ í†µí•© | 10ë¶„ |
| Phase 5 | ìµœì í™” (ì„ íƒ) | 1ì‹œê°„ |
| **ì´ê³„** | | **ì•½ 4-5ì‹œê°„** |

---

## ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ë¬¸ì œ 1: FAQ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ

**ì¦ìƒ**: `retrieval_count: 0`

**í•´ê²°**:
1. Dify Dataset IDê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
2. FAQê°€ ì •ìƒì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
3. Chunkingì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸

### ë¬¸ì œ 2: faq_id ì¶”ì¶œ ì‹¤íŒ¨

**ì¦ìƒ**: `"matched_faq_id": null`

**í•´ê²°**:
1. FAQ Markdown íŒŒì¼ì— metadataê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
2. `extract_faq_id_from_content()` ë¡œê·¸ í™•ì¸
3. ì •ê·œì‹ íŒ¨í„´ ì¡°ì •

### ë¬¸ì œ 3: policy_anchor ë§¤í•‘ ì‹¤íŒ¨

**ì¦ìƒ**: `related_laws: []`

**í•´ê²°**:
1. `faq_topic.xlsx` íŒŒì¼ ê²½ë¡œ í™•ì¸
2. faq_idê°€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
3. ë§¤í•‘ í…Œì´ë¸” ë¡œë“œ ë¡œê·¸ í™•ì¸

---

**ë‹¤ìŒ ë‹¨ê³„**: Phase 1ë¶€í„° ì°¨ê·¼ì°¨ê·¼ ì§„í–‰í•˜ì„¸ìš”! ğŸš€
